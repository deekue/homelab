hostname: k3os-001
ssh_authorized_keys:
- github:deekue
- ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBIMWQez3DYo1jeHOOE3nG7RPllzzpKW2p2R7QwmOaoj apathy@chelone
write_files:
- path: /var/lib/rancher/k3s/server/manifests/kube-vip-ds.yaml
  owner: root:root
  permissions: '0644'
  encoding: gz+base64
  content: |
    H4sICIYNqmIAA2t1YmUtdmlwLWRzLnlhbWwArVbfj9o4EH7nr7B4bmjp7q16eaPdVVWpRdWyuns4
    nVbGGcCHY+fGNru06v9+4xiCIWZFq8sDCuP55pvfDm/kH4BWGl2yzXiwlroq2QxwIwVMhDBeu0EN
    jlfc8XLAmOY1lGzt51BsZLMT2IaLvdRurYN6UBTFgCe2cc7FiHu3Mii/cUey0fqdHUnzumP9oDxB
    8d4oOKLkWhvXQmz4y7K2iBo1OGhN0pnxDeHJqaFDD8PO8+heuQ+gwMCGXkFru2Dk80cksC3ZX8Ph
    35EPrPEooJXZmBs7fMW699eW/POtSJuKziJuAzhvMUpaN3w1XEL4feJOrIJq9LDVPeEVxmAldZqm
    nCsKuD1HxiIb69HRm0CIxKFIvdy/J4HUy8ur12+P0yTPdyZDsu9h0RZ1F+8Ltkmr3xgv1tH6+T8g
    HJWyYNlO/vX+5U1jD616y6E2egbHs9HmlbQfJJl0vKbgtFeKThSfg9p1L1k6addjn4rKntHbdIP6
    ZnQ9uu5FE5FnArINiOCABUUpMhidqUN3fE68u9Q/MtmoMGDRTJKF8JzPRHjUEd/lGbk0KxTkLtgW
    sVhILd32wBdmdNKThuH610uE6tYjdetMrKDyit4+LbXpxHfPIHyILUVGm7Ndah8Aa3t8XMRM3z03
    NMH2sMpSjTVsy9ZO28wnUdY8jMAJhjHTAPJQTXb3THNv/19SYbQjcUGV1nApdwBxqakqezbabrhM
    uINfmi+TcEBv0uNYfqr8I8cm4d1w5dOVfqzfGHQZ5Zvr66u+cjAuNaV0QZPSR4FbvclihKwwQ3L1
    tk8hmkfQfK4y5s9EQIhuevugdJpzrlWVthmqBVc2w2U34mfdCyR051SAbaNTQ/0s1NJEIT+D/C0P
    Q9DwVBEtjWLO1zPFRXC4pQ6VpsqAxn0Qr6owJn3l8e9vR+Obd6Px1c1ofOgKWVMLl2y5EhhmZb+s
    upcy2Ued/lfagl+NkoKmbqKe+PbA17uZ4pPc+N9/dFJLSwhpfX2gYYNnl8614A2fSyWdhJN5pwhP
    t9L07uFxcvvl0zQjv5/8uZOujHVTcE8G1yULBR7svUhv12kuAEdbBdOPt2AdFgvqn5JNzW7JHup6
    ZqmkmLiBX4TEb52ZIzkst23m4idae017pJ5yU1/Trts7QJd6KC19vIUbIHumW+EXaW1Ofk8dug2C
    wX+gCUZUUwsAAA==
- path: /root/provision.sh
  owner: root:root
  permissions: '0744'
  encoding: gz+base64
  content: |
    H4sICJUNqmIAA3Byb3Zpc2lvbi5zaACFVFtv0zAUfk5+xVnaqSDhOk3HNLJ1iDG2l0lFKoiHbQ9u
    4rRWkzjYbkdF+e8c57beEKqUOj7f+c7tO+mc0KnI6ZTpudvBn+YGCF9KKETBEyZS101lPptLlX/X
    /MdcpvxW6MUoYanmram8ojFfUR2z9vYrU2bU/b0N+hNs+agRXTFFUzGlzaXrdmCGKUwmD/D5E0Rc
    GUikgkKJFTMcFJ8JbdQaIhbNuSsSeHyEEyAKKDcRVSzHa0UXQ01rqOC6v2ZZCs/PcAlmznMX0NvA
    1RX5Mr6D6/96uk4mlJJKh64DEMtowVVfSHzjeVxIkZvSQAC8uTGFDikdfAj6g/OL/mB43g+GF+Fw
    EFx4roPxMPiLLZCM0YH8rFz+4UEj1o+U8eAJvQA2YDgHwqqEtU6pbY9GFLEHkQgsC3NGFzcRtpM4
    zGWBTyVYCpHMNU7PnSle2MjGrCdnFZfIhTFsCpsN8GguoVfawlBxXbCXPKTaagTTNmsgDzAYvA98
    vyZYmYHv9+D6eofqWBTNo6UqOXbjvDq3iNfkYxRNqYCHRiHVzMkUvD1peTsjbqWxA7SS3AM20C3U
    ttIRPRqBZ9SS7/vt6GgDBXLz+DAtKw7Ub27sIVukbMpTmBX1q/Wy5oyhqvkvcwb+KWBLT625EgwA
    t8tWhexApLhdhSCPy5DCCJlDomSGDxQIjixqwNY+MXYNve6bOj+SHencEscG9zdVnhXPk+tsoBxj
    L7QXl72tK7KCnt/3/fubytatjdESpZ0EQOLwrVcnUQ8st2HbhA6G0KR7rIOW+3ivvG7L6FVdq5hQ
    /1t/FlMoOa3a0oFv49sxyMIgUVrx2Bfcj48lIFvwINFY4x0QU9lR9U1KJGaGYRf9Q125dcRWe3u1
    qIOqs0UsFJDiANdQNXt0wFMuTKLt2tafh3qp9rNydj0dW4+TS4zLsAH8neJpeXB88L12FUtm5M3k
    EgVBWPlF+QvRC5ckLQYAAA==
run_cmd:
- "/root/provision.sh >> /root/provision.log"
k3os:
  modules:
  - kvm
  - nvme
  sysctl:
    kernel.printk: "4 4 1 7"
    kernel.kptr_restrict: "1"
  ntp_servers:
  - 0.us.pool.ntp.org
  - 1.us.pool.ntp.org
#  server_url: https://192.168.136.10:6443
  token: SECRETSQUIRREL
  # TODO `openssl passwd -1`
  password: "k3os"
  k3s_args:
  - server
  - "--cluster-init"
  - "--tls-san"
  - "192.168.136.10"
  - "--tls-san"
  - "k8s.s.home.chaosengine.net"
  - "--disable servicelb"
    #- "--node-external-ip"
    #- "192.168.136.10"
  #- "--secrets-encryption"
