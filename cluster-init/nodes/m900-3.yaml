---
hostname: m900-3
ssh_authorized_keys:
  - github:deekue
  - "ssh-ed25519
     AAAAC3NzaC1lZDI1NTE5AAAAIBIMWQez3DYo1jeHOOE3nG7RPllzzpKW2p2R7QwmOaoj
     apathy@chelone"
write_files:
  # yamllint disable-line rule:line-length
  - path: /root/provision.sh
    owner: root:root
    permissions: '0744'
    encoding: gz+base64
    content: |
      H4sICIyWzWICA3Byb3Zpc2lvbi5zaAC9Vtty2zYQfRa/Yk07VdIxRUpJOqliOeNcX9zY46TtQ5rO
      QORSwogEGACUo4nz713wIoGi0nTamb6JwOLs4pyzCx0fhXMuwjnTS+/YOwaz5BpUKTRIAbhGtYG5
      lOYUtASBmGgwEuYIPMG8kAaF8TQaCLCUUPACU8Yzz8ukWCylEr9q/H0pM3zJ9WqWskzjdqtaChNc
      hzphzqqahWumwozPw3bRi9kLVEbP/BBNHGqdhbH9DmMW2B885TEzqEexMr6ncMG1UZtrJT9vZv7S
      mGIahuOfJ6PxT09Gj6LR48n04XjyxPdWD/VNHcyxBVdMxEtUIe2Fars52rA88z3ihy5bFvDb5cVb
      4MKgSlmM2rM7C6LBLBHiUimiBWxlp0Bg8Qp4CtwMNbBMIUs2dFQblmWY2GqrQu0FZ/7JfTqdQZBq
      8E86F6G7Vtd74HsE9uEDBKIO2Z724eNHeGpLEB7YjEewUFhA8Ok2hbP7S0oMwQTOzs56B+/AkGwQ
      jB/QVkO2v8MCwHgpwb9IEi4W0HC2gQoBXlxUV/WdwD3483MHlsJS7qG1QhtuPYOJNZZCS/cav5UD
      zn+YeHS84eAIAkXQHR27NNQJXkiR8kWpHNzC4tpiyDnESfDq6jWc97C8Qc6VkkpPvQFAIuMVqhGX
      9IUiKSQ5oNoIYF8uOkmIVal1CbVvLn55Tw5SnGUQS6GpM3yvEQmM2bx7BJUJueDGsDnc3dUXGFZ7
      06lCXbBbMQ217VkynNlAcAnj8eNJFDUAazOOoqHl3IU6lEUjma3C6ObZHd5GdG+RUOtCKhVcNg26
      9eScePjidvjXnispzIlxBwTFzmbgG1Vi91R77uhQgvF+bCs6QKmtXW8tfl3z3tHOHSBhhvkNgmOK
      OyiYMmTP3s28QaHIAeSRVcbmmMGiqD5sPPmL54x8hp/NI4juAYlyr/ZEncEGkQfnWH2TT6jsuifq
      vXeG1QOhyR7kB6gtSVx48xyqOiBViPBHg39XN/9walefDvfXgzUMo1EUvXleB5y4EXFJAz2dQJBM
      d6s0I0iYB76jRzWCvmyr/foNJWyYkKYnxyldW1QTpaqcrB3jaDTyHYYO0U4lHSTZP9lW4td0H2K6
      dUciBTapKvJtpwIcU4/DLcKS0Qxi9ADmBbWHReCGS/GMQtpirmnxbZn/a4laIV6RRtMPf04//jjd
      qdBqMHY0cBVw+d8rqKeCuz/bL/DQcWLh/dXLK9BlUUhiWRKUqkiwHIBgOWk2AlyAWOcYiXExdmY/
      9VTOjFW1i/0VbrlZVlLVtDdZZGFIxKzW0H7QXHxWBeQrnNBDGKxfQ2DqfRp2LWZg+5U4j+Af3Mnt
      rp7GFngrcftE96j7L1p31bYJe4of1vzv+u57uv+fyrfctiZ4dXNzdTN1WLX9n8pSJGFM9FoGafH7
      47h67xvgz0TuuNOwzruwNydUj426rpytrDMTrmAvvHGc3QmKHlg3X/cVuj40+ty/XweCq9c11faN
      P/BylUVSd9AurB2K7fDu3dZBpPl47nyPTF504PeqGXShBtaeAyGJCSoix1OFWfUDIoiq4Xv+DfR8
      vbfufO5020pBbjg4JvaMsdXGxkPAnI+mqXr01mrZif4XQyHDl94MAAA=
  # yamllint disable-line rule:line-length
  - path: /etc/network/interfaces
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluAHWP3Q7CIAyF73mKJt4aMthm9HHqxpTAgAjE7O0tmUuYPxel5ZwvB4o5
      ebCe6QkHRQNopxJ1H644GIbFVunevIEyrsiMLqNlADmAnugoFu+aT0V8Ke0Pps6nkPWJmDDpgWAc
      x4eKEcRFcnE6E8BbkomZMRqQfc+3Ktk3TOqJS43LvmPsAFY7A97Z5bhlqkh3CH6M9Q/EfsnKaf86
      tMTOegEE0KRUWgEAAA==
  # static DNS config
  - path: /etc/resolv.conf
    owner: root:root
    permissions: '0644'
    encoding: ""
    content: |-
      search home.chaosengine.net
      nameserver 192.168.40.254
run_cmd:
  - "/root/provision.sh >> /root/provision.log 2>> /root/provision.err"
boot_cmd:
  # enable NFS client
  - mkdir -p /var/lib/nfs/sm
  - rc-update add rpc.statd
  - rc-update add nfsclient
  # use static network config rather than connman
  - rc-update add networking boot
  - rc-update del connman boot
k3os:
  modules:
    - kvm
    - nvme
  sysctl:
    kernel.printk: "4 4 1 7"
    kernel.kptr_restrict: "1"
  dns_nameservers:
    - 192.168.40.254
  ntp_servers:
    - 0.us.pool.ntp.org
    - 1.us.pool.ntp.org
  server_url: https://192.168.40.10:6443
  token: SECRETSQUIRREL
  password: "$1$ZDYMI7GJ$0F0YZRwBXP4l3CQItcXMg/"
  k3s_args:
    - server
    - "--tls-san"
    - "192.168.40.10"
    - "--tls-san"
    - "k8s.s.chaosengine.net"
    # replace with kube-vip LB
    - "--disable"
    - "servicelb"
    # replace with Cilium
    - "--flannel-backend=none"
    - "--disable-network-policy"
