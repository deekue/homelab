---
hostname: m900-3
ssh_authorized_keys:
  - github:deekue
  - "ssh-ed25519
     AAAAC3NzaC1lZDI1NTE5AAAAIBIMWQez3DYo1jeHOOE3nG7RPllzzpKW2p2R7QwmOaoj
     apathy@chelone"
write_files:
  # yamllint disable-line rule:line-length
  - path: /root/provision.sh
    owner: root:root
    permissions: '0744'
    encoding: gz+base64
    content: |
      H4sICOpz0mICA3Byb3Zpc2lvbi5zaAC9Vl1T20YUfUa/4iLsAin6sEM61MFkCCHpQ1IYSKfToenM
      WlrZO5Z2ld2VwQP8995dybZkmaahM+UF7+7d+3HOvWe1sx2MGA9GRE2cHWcH9IQpkAVXIDjQGZVz
      GAmhD0AJ4JTGCrSAEQUW0ywXmnLtKKrBo4WAnOU0ISx1nFTw8URI/puiv09ESt8xNR0mJFV0eWS3
      gpjOAhWT2q4cBjMig5SNgsWmE5EzKrUaugHVUaBUGkRmHUTEMz9YwiKiqfIjqV1H0jFTWs4vpbib
      D92J1vkgCHo/9/3eT0f+Yei/6g9e9vpHrjN9qa5KY0YXziXh0YTKAM8CuTz05yRLXcdJCh5phsik
      Ygz3DuD/iKTgScjUeOh2XqANAI0mAtzOXoxJwY/dP7pZN/a6v3Q/da/3oYOWrvPoINZjBE5PKESF
      lAgkmFoOAMNHU2AJML2rgKSSkngOjCtN0pTGpj5bmoEEQ+7hbcwgURixUTqiYwHZdx10dnMDHi9N
      lrdd+PIFXpsUOGaNRtswljQH7+ttAsd7EwwMXh+Oj49bFx9AI9Hg9fbxqKLHXfkCC5B7GseMj6EC
      eQ7WAZyd2kpda1dh1fR+clLzimYJc6jpncqt6TEam0aU1NAzo0+FgJMf+g7erhDYNky5nQbvTRCs
      /zPBEzYuZM1tbtyaVLDREBDv/OI9nLRcOVsZk1JINXC2AGIRTan0mbArLJXHuWBcV0sAD9Y5c83R
      eBI949bXgsyfEes5oaZHyv/+i7D869w3jnZ2qhl9/K48kAJLraUMNajI4fTTZ1BUMhzJSHCFwuM6
      VUeD1vPrQ7AzzjjTmozg4aFsv117NhhIqnJyyweBMpKI06nn4H2EXu9VPwwrBzPdC8Nd06F1V5ui
      KIqTaX0046wuLy0aRcQojJAICR8r+VvO7whRuK/r52NrgtGsZlOXX7QdDsHVsqDNW4t725sC9NZt
      qxEBKJQZ7Vvjvkx57WajBEApJIsWqI3QA+REapzlVmHOVi6xBXCipikZ0RTGuV0Ye5xGlhGcSnqn
      DyHsAlLSLRuijGCMcGJH1K6xSbCnSv0oz641KbWziu5lG5AtkFr48BZsHpBISuHPyv9DqZO7A7P7
      end935vBbuiH4Ye3pUGnbhEV+FomffDiwWoX5RR52XdrdFi1vl9m+/gEEVzoFhUHWDK3ymuzxqaO
      qO/7bg2dTZBjOhsBdjvLLNwS6k0oV/nEgtMqksXdTCjADooh3FKYENRqgh8WWY5zYRww85y+scpb
      5nKJm78W2bPZWXBwjvQMbv4afHkxWBGwgL9Xg78Ofh36tYRaBNTPh+sJbrqOKHy+eHcBqshzgSAL
      dCUtCPaTgpMMKfOBjoHPMhryXt5bPaU4TRnRhtOm60e4ZXpiiSpRr4KIXCOFacmgWaAevrEG2ZT2
      8WvBm70HT5fnKHILn56ZVIQ8hH9RUn2uWhQbx0uGF98xLeT+C9VNsk3AFuGbKf+nifsW7f8j8Uts
      qx44v7q6uBrUQDXDn4iCx0GE6BoAcfPbOmy/ikq/9A6x7TXGtfYerImE3DADmFZGpqYvYyZhzbrq
      N3Pi5S1fzXDNx+dyk+TVv1A3GNs3NVHmZW/rZJHH5fisrBZ6uNDsVq01hyiNJ7W1r7N8gWD5AdtM
      Zqvpasv05hYXCAQmkdEDSVP7A0IIre6ePOE9m63t15Yr1hZEYCtslIi1rlgyY+zBI7VFNVAtcEuu
      jJj/DQKAL2AxDgAA
  # yamllint disable-line rule:line-length
  - path: /etc/network/interfaces
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluAJ2RXQ6DIBCE3z3FnsDgD017nK1SQ1QkAm1MPHwX0VRNE20fCOzOl5ks
      i8520HSRfGAh6AFSCUt3p+9Y1BF62fZO1WxGQhGwFpXDJgJwGqSGRqoaDPVnxumthGUZHrOusF38
      4oQB2EELeDaoQJbgG+PoZXHeJdu7ZP+45HuX/B+XhLH9ROy7y+fLpm8g5QjLzmE+cYWtlkkzbvbp
      Z55WaixaWZAjjdYLYyC5pXFyuRIQZ9QmpkVTQ8p5vBxG/QqteOGwxlOeh0hjux4rsSQu5UEg/y2Q
      h8A3+AAH69ACAAA=
  # yamllint disable-line rule:line-length
  - path: /etc/mactab
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluACspKs3LNlAwMLAyMrYyMrFKNrcyMrIyTuQqLskvSkxPBUulGliZJFuZ
      WViZpFoZmnEBAGauvkY0AAAA
  # static DNS config
  - path: /etc/resolv.conf
    owner: root:root
    permissions: '0644'
    encoding: ""
    content: |-
      search home.chaosengine.net
      nameserver 192.168.40.254
run_cmd:
  - "/root/provision.sh >> /root/provision.log 2>> /root/provision.err"
boot_cmd:
  # enable NFS client
  - mkdir -p /var/lib/nfs/sm
  - rc-update add rpc.statd
  - rc-update add nfsclient
  # use static network config rather than connman
  - rc-update add networking boot
  - rc-update del connman boot
  # persistent network device naming
  - nameif -s
k3os:
  modules:
    - kvm
    - nvme
  sysctl:
    kernel.printk: "4 4 1 7"
    kernel.kptr_restrict: "1"
  dns_nameservers:
    - 192.168.40.254
  ntp_servers:
    - 0.us.pool.ntp.org
    - 1.us.pool.ntp.org
  server_url: https://192.168.40.10:6443
  token: SECRETSQUIRREL
  password: "$1$ZDYMI7GJ$0F0YZRwBXP4l3CQItcXMg/"
  k3s_args:
    - server
    - "--tls-san"
    - "192.168.40.10"
    - "--tls-san"
    - "k8s.s.chaosengine.net"
    # replace with kube-vip LB
    - "--disable"
    - "servicelb"
    # replace with Cilium
    - "--flannel-backend=none"
    - "--disable-network-policy"
