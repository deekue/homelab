---
hostname: m900-3
ssh_authorized_keys:
  - github:deekue
  - "ssh-ed25519
     AAAAC3NzaC1lZDI1NTE5AAAAIBIMWQez3DYo1jeHOOE3nG7RPllzzpKW2p2R7QwmOaoj
     apathy@chelone"
write_files:
  # yamllint disable-line rule:line-length
  - path: /root/provision.sh
    owner: root:root
    permissions: '0744'
    encoding: gz+base64
    content: |
      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
  # yamllint disable-line rule:line-length
  - path: /etc/network/interfaces
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluAJ1S227CMAx95yss7ZnS67RJ075gP2GaUKK2cZcLCImPn5sSoB3S0B6q
      xvbJOfZx0DuCjlZqh7XkAygtHf9p2GLdrnAsO+N1m14gUzDBetQeuxWAH0AN0CndguX8BeOHeQmF
      mA6XusY+8iVZCuBOg4RDhxqUgDFxPo9l+TxLsWQp/sNSLlnK/7BkabqcKH3McrMs2MCVv2DFc7BR
      8Q52t0yecbbPceawUuvQqZoZeTQjrYXsPU+y1zcGJAWnGdOjbSGvqiR+KecbdPKIp3t4XpWTpHVk
      sJFRMYaLN/QCg3ewJ+uu2qQBGVAHB6fhKCA+1p81aYfMYOBIprWBwMhvr4wUsCMDX6SbPRm9Uba2
      CkXPek4arJ0i/duya1ePXq3dq359RUx3YhR2HJvsSUjYGiWa21bGaQJL9KZiKzd5CUIe5swPupoJ
      c2s/Cn3jsbADAAA=
  # yamllint disable-line rule:line-length
  - path: /etc/mactab
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluACspKs3LNlAwMLAyMrYyMrFKNrcyMrIyTuQqLskvSkxPBUulGliZJFuZ
      WViZpFoZmnEBAGauvkY0AAAA
  # static DNS config
  - path: /etc/resolv.conf
    owner: root:root
    permissions: '0644'
    encoding: ""
    content: |-
      search home.chaosengine.net
      nameserver 192.168.40.254
run_cmd:
  - "/root/provision.sh >> /root/provision.log 2>> /root/provision.err"
boot_cmd:
  # enable NFS client
  - mkdir -p /var/lib/nfs/sm
  - rc-update add rpc.statd
  - rc-update add nfsclient
  # use static network config rather than connman
  - rc-update add networking boot
  - rc-update del connman boot
  # persistent network device naming
  - nameif -s
k3os:
  modules:
    - kvm
    - nvme
  sysctl:
    kernel.printk: "4 4 1 7"
    kernel.kptr_restrict: "1"
  dns_nameservers:
    - 192.168.40.254
  ntp_servers:
    - 0.us.pool.ntp.org
    - 1.us.pool.ntp.org
  server_url: https://192.168.40.10:6443
  token: SECRETSQUIRREL
  password: "$1$ZDYMI7GJ$0F0YZRwBXP4l3CQItcXMg/"
  k3s_args:
    - server
    - "--tls-san"
    - "192.168.40.10"
    - "--tls-san"
    - "k8s.s.chaosengine.net"
    # replace with kube-vip LB
    - "--disable"
    - "servicelb"
    # replace with Cilium
    - "--flannel-backend=none"
    - "--disable-network-policy"
