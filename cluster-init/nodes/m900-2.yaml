---
hostname: m900-2
ssh_authorized_keys:
  - github:deekue
  - "ssh-ed25519
     AAAAC3NzaC1lZDI1NTE5AAAAIBIMWQez3DYo1jeHOOE3nG7RPllzzpKW2p2R7QwmOaoj
     apathy@chelone"
write_files:
  # yamllint disable-line rule:line-length
  - path: /root/provision.sh
    owner: root:root
    permissions: '0744'
    encoding: gz+base64
    content: |
      H4sICKA/smICA3Byb3Zpc2lvbi5zaAC9VV1v2zYUfbZ+xY2SLtsQfdjJhkytXbRr2pdsKZIOe8gy
      gJaubcISqZGUXWPJf9+lPmzJVpdhA5aHwCQP770859yr46NgykUwZXrhHDvHYBZcgyqEBikAV6g2
      MJXSnIGWIBATDUbCFIEnmOXSoDCORgMeFhJynuOM8dRxUinmC6nELxp/XcgU33G9HM9YqnF7VG4F
      Ca4CnbDWrhoHK6aClE+DZtNx+Azu7+EIPAUBmjhQTMQLVMHyXAcK51wbxVH7G5al8PAAL+kZKBwA
      jBcS3DkVeHd3DT++gRiVgZlUkCu+Ygahvr2BmFFEl+7EzMCrV97VzXuYPJvNGWRcKal05AwAEhkv
      Uflc0gpFkksuTHngAbgLY3IdBcHwh5E//P7Svwj90flldD4cXbrOgNJR7rUt1fujAvdjg5j5sTIu
      /EZ4inxT1ah1GtjHaTr37A8+4/QSKpPAzow7TsUFiVXk8OanT6BRcZZCLIUmhVxnrjC3uY3Z3F1U
      QbngxrApPD5WTJ6WZ1GkUOdsLaJAW+9QzWYD3jUMh9+NwrAOsDLDMDyFyaQTqi+LxrhQZYxunt3l
      LaL7ioQsVIp5XRvFrY3iTcE9+bPttCe344sK1sK0jUrY8Rhcowrs3mruHfUlGO5jG/cBFJqLOaxt
      /KrmvaudN0DCDHPrCC0vPkLOlMHk8GXOgMxMfTjIlimbYgrzvFxYvPV5xsje+NlcQPgCSJQXjdvs
      nwXlSk6xXJNPqGzbps3ZnaF/Y/fk6zq7l/VQW5C48OEtlHXATCHW7gQqu1T8NLK7L0/3970VnIZ+
      GH54WwFO2oi4oGaYjcBLot3uI1hhvnFbenjC1rSt9ukLSliYkOZAjjN6tkjsXlk5WTtG3/fdFkN9
      tFNJvSS7J9tK3IruPqYbdyRSYJ2qJN92KsAxjRJYIyzYCoHRIM5yag8bgRsuxWuCNMV8pM2fi+xf
      S9QIcUUaRfe/Rw/fRjsVGg2GLQ3aCrT53yvoQIX2+Xi/wL7rxMKnm3c3oIs8l8SypFCqJMFyAIJl
      pJkPOAexyjAUw3zo7IilnsqYsap2Yz/BmptFKVVFe51F5oZETCsN7YLm4usSkC1xNNNk1ffgmeqc
      hl0T07P9SpyH8A/e1O6uA41t4K3EwFKFLNkcUPdftO6qbRMeKN6v+d/13XO6/5/KN9w2Jri6vb25
      jVqs2v6fyUIkQUz0WgZp8/lxDJOvRk3gz0TusNOwre/C3pxQB2xUdWVsaZ2ZcAV78Npx9sTLD4J1
      83W/Qh/7Rh8Bj6D55h6Cy6/rTNtvfM+Xq8iTqoN2sGYoNsP74LWtiDQfJ621b7K8E36vmkE31MDa
      cyAkMUFFZHimMC1/QAhhOXwnX4ierfb2W8udblspyA29Y2LPGFttLB481lrUTXVAb6WWneh/AZ9S
      nA1mCwAA
run_cmd:
  - "/root/provision.sh >> /root/provision.log 2>> /root/provision.err"
boot_cmd:
  # enable NFS client
  - mkdir -p /var/lib/nfs/sm
  - rc-update add rpc.statd
  - rc-update add nfsclient
k3os:
  modules:
    - kvm
    - nvme
  sysctl:
    kernel.printk: "4 4 1 7"
    kernel.kptr_restrict: "1"
  dns_nameservers:
    - 192.168.40.254
  ntp_servers:
    - 0.us.pool.ntp.org
    - 1.us.pool.ntp.org
  server_url: https://192.168.40.10:6443
  token: SECRETSQUIRREL
  password: "$1$ZDYMI7GJ$0F0YZRwBXP4l3CQItcXMg/"
  k3s_args:
    - server
    - "--tls-san"
    - "192.168.40.10"
    - "--tls-san"
    - "k8s.s.chaosengine.net"
    # replace with kube-vip LB
    - "--disable"
    - "servicelb"
    # replace with Cilium
    - "--flannel-backend=none"
    - "--disable-network-policy"
