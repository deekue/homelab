---
hostname: m900-2
ssh_authorized_keys:
  - github:deekue
  - "ssh-ed25519
     AAAAC3NzaC1lZDI1NTE5AAAAIBIMWQez3DYo1jeHOOE3nG7RPllzzpKW2p2R7QwmOaoj
     apathy@chelone"
write_files:
  # yamllint disable-line rule:line-length
  - path: /root/provision.sh
    owner: root:root
    permissions: '0744'
    encoding: gz+base64
    content: |
      H4sICGQVv2ICA3Byb3Zpc2lvbi5zaAC9VV1v2zYUfbZ+xY2SLtsQfdjJhkytU7Rr2pdsKZIOe8gy
      gJaubcISqZGUU2PJf9+lPmzJUpdhA5aHwCQv7z0859yrw4NgxkUwY3rpHDqHYJZcgyqEBikA16g2
      MJPSnICWIBATDUbCDIEnmOXSoDCORgMeFhJynuOc8dRxUikWS6nELxp/XcoU33G9ms5ZqnF7VG4F
      Ca4DnbDWrpoGa6aClM+CZtNx+Bzu7uAAPAUBmjhQTMRLVMHqVAcKF1wbxVH7G5alcH8PL+kZKBwA
      jJcS3AUBvL29gh/fQIzKwFwqyBVfM4NQ395AzCijS3diZuDVK+/y+j1cPFvNGWVcKal05IwAEhmv
      UPlc0gpFkksuTHngAbhLY3IdBcH4h4k//v7cPwv9yel5dDqenLvOiMpR7QcL1fujCh6ODWLmx8q4
      8BvFA1zUGLVOA/s4Teee/cHnnF5CMCnYmXPHqbggsYoc3vz0CTQqzlKIpdCkkOssFOa2tjGb27Mq
      KRfcGDaDx8eKyePyLIoU6pw9iCjQ1juE2WzAu4Lx+LtJGNYJ1mYchsdbfHWqoSoa40KVObp1dpe3
      Ed1XJGShUsyr2ihubRRvBu7Rn22nPbkdX1RhrZi2USl2OgXXqAK7t5p7B0MFxvuxjfsACs3FAh5s
      /grz3tXOGyBhhrl1hpYXHyFnymDSf5kzIjNTH46yVcpmmMIiLxc23vo8Y2Rv/GzOIHwBJMqLxm32
      zwblSs6wXJNPCLZt0+bs1tC/qXv0dV3dywaoLUhc+PAWShwwV4i1O4Fgl4ofR3b35fH+vreG49AP
      ww9vq4CjdkRcUDPMJ+Al0W73Eaww37gtPTxhMW3RPn1BCRsmpOnJcULPFondK5GTtWP0fd9tMTRE
      O0EaJNk92iJxK7qHmG7ckUiBdamSfNupAIc0SuABYcnWCIwGcZZTe9gM3HApXlNIA+Yjbf5cZP9a
      okaIS9Iouvs9uv822qnQaDBuadBWoM3/HqCeCu3z6T7AoevEwqfrd9egizyXxLKkVKokwXIAgmWk
      mQ+4ALHOMBTjfOzsiKWeypixqnZzP8EDN8tSqor2uorMDYmYVhraBc3F12VAtsLJXJNV34NnqnMa
      dk1Oz/YrcR7CP3hTu7t6GtvEW4mBpQpZsulR91+07qptC/YUH9b87/ruOd3/T+UbbhsTXN7cXN9E
      LVZt/89lIZIgJnotg7T5/DiGi68mTeLPRO6407Ct78LenFA9NipcGVtZZyZcwV547Th74uW9ZN16
      3a/Qx6HRR4EH0Hxz+8Hl13Wu7Td+4MtV5EnVQbuwZig2w7v32lZGmo8XrbVvsryTfg/NqJtqZO05
      EpKYIBAZnihMyx8QQlgO34svZM/We/ut5U63rRTkhsExsWeMrTY2HjzWWtRN1aO3UstO9L8AkFYr
      QGYLAAA=
run_cmd:
  - "/root/provision.sh >> /root/provision.log 2>> /root/provision.err"
boot_cmd:
  # enable NFS client
  - mkdir -p /var/lib/nfs/sm
  - rc-update add rpc.statd
  - rc-update add nfsclient
k3os:
  modules:
    - kvm
    - nvme
  sysctl:
    kernel.printk: "4 4 1 7"
    kernel.kptr_restrict: "1"
  dns_nameservers:
    - 192.168.40.254
  ntp_servers:
    - 0.us.pool.ntp.org
    - 1.us.pool.ntp.org
  server_url: https://192.168.40.10:6443
  token: SECRETSQUIRREL
  password: "$1$ZDYMI7GJ$0F0YZRwBXP4l3CQItcXMg/"
  k3s_args:
    - server
    - "--tls-san"
    - "192.168.40.10"
    - "--tls-san"
    - "k8s.s.chaosengine.net"
    # replace with kube-vip LB
    - "--disable"
    - "servicelb"
    # replace with Cilium
    - "--flannel-backend=none"
    - "--disable-network-policy"
