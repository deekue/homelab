---
hostname: m900-2
ssh_authorized_keys:
  - github:deekue
  - "ssh-ed25519
     AAAAC3NzaC1lZDI1NTE5AAAAIBIMWQez3DYo1jeHOOE3nG7RPllzzpKW2p2R7QwmOaoj
     apathy@chelone"
write_files:
  # yamllint disable-line rule:line-length
  - path: /root/provision.sh
    owner: root:root
    permissions: '0744'
    encoding: gz+base64
    content: |
      H4sICIrZ0mICA3Byb3Zpc2lvbi5zaAC9Vltv2zYUfo5+xYlsN00X3ZymyNw4RXrdQ7sUaYdh6DqA
      liibsESqJOXUSPLfd0hJtmS7a7MBe7JFHp7L953zkb39YMJ4MCFq5vScHugZUyBLrkBwoAsqlzAR
      Qh+BEsApTRRoARMKLKF5ITTl2lFUg0dLAQUraEpY5jiZ4NOZkPw3RX+fiYy+ZGo+Tkmm6GrLLgUJ
      XQQqIa1VOQ4WRAYZmwTNohOTF1RqNXYDquNAqSyIzXcQE8/8YSmLiabKj6V2HUmnTGm5fC/F1+XY
      nWldqFEQRD8P/ejJqf849E+Go+NoeOo682N1VVkz2niXhMczKgPcC+Rq01+SPHMdJy15rBlCk4kp
      3DiAvzHJwJOQq+nY7T9CGwAazwS4/YcJZgU/Df4Y5IPEG/wyeDf4cAh9tHSdOwfBniJyekYhLqVE
      JMEUcwQYPp4DS4HpAwUkk5QkS2BcaZJlNDEF2toMJhjyIZ7GDFKFETu1IzwWkUPXQWefPoHHK5PV
      aRc+f4anJgWOWaPRPkwlLcD7cp3C2cMZBgZvCGdnZ1sHb0Ej0+BFh7hV8+OufYEFyL1IEsanUIO8
      BOsAXlzYSl1rV2PV9X5+3vKKZilzqGme2q1pMpqYTpTU0LOg3woB5w+GDp6uEdg3TLn9Du9dEHrQ
      NMyU6Vk58WORm17wmLAtwZQqqQqGYXTSs/+9Jycnp8fDk+MnTXYvBE/ZtJStpAqTlCkE+xThfHX5
      Gs638nByJqWQaoR2iYjnVPpMjCqQeFIIxnX1BeDBJtnG+XQW3/fIl5Is7xvl3kHmp8q//6n+TWep
      1zPEIC93P+4EcXYs+5YX1KmygIt3H0FRyXBqY8EVipPr1E0PWi8/PAYrA4wzrckEbm+rDj2we6OR
      pKog13wUKCObOMB6Cd5biKKTYRjWDhY6CsMD08RtV7uiKIrDa31046wPryw6RSQonpAKCW9riVyN
      +ARRuGlr7N3WkKNZy6Yt0Wg7HoOrZUm7p5pz+7sCRJu29RwAlMpM/7VxX6W8cbJTAqBaErd2UM2J
      ZwblFgoiNY77VmHOXiGxA5y9fJ6RCc1gWtgPY48jx3KCo0e/6scQDgApGTh7piOqCMYIx3JC7Tc2
      CbZUJTHV3gdNKnmto3v5DmRLpBbePAebB6SSUviz9n9bSenByKw+Pdhc9xZwEPph+OZ5ZdBvW8Ql
      3qjpELxktF5FxUVeDt0WHVbQb1bZ3n2DCC70FhVHWDK34myzxqaOqe/7bgudXZCv0gHYhbPbXyXj
      VojvArtOKxGc1gEt/GZQjQAnAq4pzAiqOsE3SF7geBgHzFy8z6zKVim9x8Vfy/xfk9RQ8QpZGn36
      a/T50WjNQ8NC1GKhzUGbgY2Etnho7483E9x1HFH4ePnyElRZFAJBFuhKWhDs44OTHJnzgU6BL3Ia
      8qiI1pcuDlVOtKG26/oOrvFKs0RVqNdBRKGRwqxi0HygLD5zKorpEN8V3uI1eLraR61rfHpmYBHy
      EH6gpPZ4bVFsHK8Ybl48W8j9F6q7ZJuAW4TvpvyfBu97tP+PxK+wrXvg1dXV5dWoBarRgFSUPAli
      RNcAiIvfl2P7fqr80q+IbdQZ19a1sKEVcscMYFo5mZu+TJiEDeu638yOV2z56obr3kHvdylf+y27
      w9herakyF/y2XJZFUo3P2qqRxUa6t2ptOVwr5Hlr2dd50QBZvXi7Oe11Pe6ZFt3jAvHAXHJ6JGlm
      /0AIYVuFz78RJF9srLc+1xw2tGBj7BSMjR5Z8WTswSOtj3q8tqCumDPS/jdiRPw4ag4AAA==
  # yamllint disable-line rule:line-length
  - path: /etc/network/interfaces
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluAJ1S227CMAx95yss7ZnSlnbaJLQv2E+YJpSobdzlAkLi4+emBGiHNMRD
      1dg+Occ+DnpH0NJC7bCSfAClpeM/9VusmgUOZWe8btILZAxGWIfaY7sA8D2oHlqlG7Ccv2B8Py2h
      EOPhUtfYRb4kSwHcqZdwaFGDEjAkzuehLJ9nWc9Z1q+wFHOW4hWWLE3nE6WPWW6WBRu48h9s/Rxs
      ULyD3S2TZ5zsc5g5rNQ6dKpiRh7NSGsh+8yT7P2DAUnOacZ0aBvIyzKJX8r5Gp084mkCL4tR0joy
      WMuoGMPZG3qD3jvYk3VXbdKADKiCg+NwFBCb5VdF2iEzGDiSaWwgMPLHKyMF7MjAN+l6T0avlK2s
      QtGxnpMGK6dI/7Xs2tWjV2v3qlteEeOdGIUdxyY7EhK2Ron6tpVhmsASvSnZm1VegJCHKfODribC
      3NovHnxSpbADAAA=
  # yamllint disable-line rule:line-length
  - path: /etc/mactab
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluACspKs3LNlAwMLAyMrYyMrFKTLZKM7eytOQqLskvSkxPBUulGliZJFuZ
      WViZpFqlpHEBAFNDlwk0AAAA
  # static DNS config
  - path: /etc/resolv.conf
    owner: root:root
    permissions: '0644'
    encoding: ""
    content: |-
      search home.chaosengine.net
      nameserver 192.168.40.254
run_cmd:
  - "/root/provision.sh >> /root/provision.log 2>> /root/provision.err"
boot_cmd:
  # enable NFS client
  - mkdir -p /var/lib/nfs/sm
  - rc-update add rpc.statd
  - rc-update add nfsclient
  # use static network config rather than connman
  - rc-update add networking boot
  - rc-update del connman boot
  # persistent network device naming
  - nameif -s
k3os:
  modules:
    - kvm
    - nvme
  sysctl:
    kernel.printk: "4 4 1 7"
    kernel.kptr_restrict: "1"
  dns_nameservers:
    - 192.168.40.254
  ntp_servers:
    - 0.us.pool.ntp.org
    - 1.us.pool.ntp.org
  server_url: https://192.168.40.10:6443
  token: SECRETSQUIRREL
  password: "$1$ZDYMI7GJ$0F0YZRwBXP4l3CQItcXMg/"
  k3s_args:
    - server
    - "--tls-san"
    - "192.168.40.10"
    - "--tls-san"
    - "k8s.s.chaosengine.net"
    # replace with kube-vip LB
    - "--disable"
    - "servicelb"
    # replace with Cilium
    - "--flannel-backend=none"
    - "--disable-network-policy"
