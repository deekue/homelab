---
hostname: m900-2
ssh_authorized_keys:
  - github:deekue
  - "ssh-ed25519
     AAAAC3NzaC1lZDI1NTE5AAAAIBIMWQez3DYo1jeHOOE3nG7RPllzzpKW2p2R7QwmOaoj
     apathy@chelone"
write_files:
  # yamllint disable-line rule:line-length
  - path: /root/provision.sh
    owner: root:root
    permissions: '0744'
    encoding: gz+base64
    content: |
      H4sICBd40mICA3Byb3Zpc2lvbi5zaAC9Vl1v2zYUfY5+xY1iL0kXfdhNh06NU6Sfe2iXIOkwDF0H
      0BJlE5ZIlaScGEn++y4p2ZYsZ202YE+2yMtzL8+590h7u8GY8WBM1NTZc/ZAT5kCWXIFggOdU7mA
      sRD6CJQATmmiQAsYU2AJzQuhKdeOoho8WgooWEFTwjLHyQSfTIXkvyn6+1Rk9A1Ts1FKMkVXW3Yp
      SOg8UAlprMpRMCcyyNg4WC46MXlNpVYjN6A6DpTKgtg8BzHxzB+WsphoqvxYateRdMKUlosLKW4W
      I3eqdREFweDnoT/46bl/HPrPhtHTwfC568yeqssqmNEluCQ8nlIZ4F4gV5v+guSZ6zhpyWPNkJlM
      TODWAfyNSQaehFxNRm7vCcYA0HgqwO0dJFgU/Nj/o5/3E6//S/9j/+oQehjpOvcOcj1B4vSUQlxK
      iUSCucsRYPp4BiwFpvcVkExSkiyAcaVJltHE3M9ezVCCKQ/wNFaQKszYujqyYwk5dB0E+/wZPF6F
      rE678OULvDAlcKwag3ZhImkB3tfrFE4OppgYvCGcnJx0Dt6BRqHBGxziVi2Pu8YCS5B7liSMT6Am
      eQEWAF6f2Zu6Nq7mqo1+etpAxbCUOdT0Tg1reowmphElNfLM6UMp4PSHoYOnawZ2jVJur6V7mwSL
      /1rwlE1K2YAtDKwpBRsNCXl7/g5OO0hOzqQUUkUYl4h4RqXPRFRdkyeFYFxXTwAebMplwCfT+LFH
      vpZk8dgsj04ye678x5/q3baW9vbqUbz/fhDk2bH6WV3QaMoCzj5+AkUlw7mLBVfoLq5Tty1ovbg6
      BjvIjDOtyRju7qoe27d7USSpKsg1jwJlfA9HUC/A+wCDwbNhGNYAcz0Iw33Thk2obVkUxfGzGO08
      68OriNYlEnQ/SIWED7XHrYZ0jCzcNk3yvjOmGNaIaXosxo5G4GpZ0vap5bndbQkGm7H1HACUyszv
      tYGvSt442boCoN8Rtwao5sQzg3IHBZEaB7ZzMWenkNgBzk4+y8iYZjAp7IOJx5FjOcHRozf6GMI+
      oCR9Z8d0RJXBBOFYjql9xibBlqpMotq70qQyyDq7l29htkRp4f0rsHVAKimFP2v8u8oM9yOz+mJ/
      c92bw37oh+H7V1VArxkRl/hKTIfgJdF6FT0TdTl0G3JYS75dVXv/gBBc6I4UR3hlbu3VVo1NHVPf
      990GO9soX5UDsI1nt7cqxq0Y30Z2XVYiOK0TWvrNoALsoffBNYUpQV8m+BGRFzgeBoCZV+dL67JV
      SRe4+GuZ/2uRllK8RZWiz39FX55Eax2WKgwaKjQ1aCqwUVBHh+b+aLPAbceRhU/nb85BlUUhkGSB
      UNKSYD8fOMlROR/oBPg8pyEfFIP1axOHKifaSNuGvodrpqdWqIr1OokoNEqYVQqaB7TFl04lMR3i
      l4E3fweervbR65aYnhlYpDyE77hSc7w6EhvglcLLb5YOc/9F6rbYJmFH8O2S/9PgfUv2/1H4Fbd1
      D7y9vDy/jBqkGg9IRcmTIEZ2DYG4+G07tl9AFS69QW4HrXFtvBY2vEJumQEsKycz05cJk7ARXfeb
      2fGKDlY7XfsddLHN+Zpfo1uC7as1VeYF37XLskiq8VlHLW1xad2duzYA1w552lj2dV4siay+Wds1
      7bQRd0yL7nCBfGAtOT2SNLN/IISw6cKnDyTJ5xvrjce1hktZsDG2GsZGj6x0MvHgkcZDPV4dqivl
      jLX/DTFVbFkrDgAA
  # yamllint disable-line rule:line-length
  - path: /etc/network/interfaces
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluAJ2RXQ6DIBCE3z3FnsDgD017nK1SQ1QkAm1MPHwX0VRNE20fCOzOl5ks
      i8520HSRfGAh6AFSCUt3p+9Y1BF62fZO1WxGQhGwFpXDJgJwGqSGRqoaDPVnxumthGUZHrOusF38
      4oQB2EELeDaoQJbgG+PoZXHeJdu7ZP+45HuX/B+XhLH9ROy7y+fLpm8g5QjLzmE+cYWtlkkzbvbp
      Z55WaixaWZAjjdYLYyC5pXFyuRIQp9QmpkVTQ8p5vBxG/QqteOGwwXkeIo3teqzEkriUB4H8t0Ae
      At+wk6w40AIAAA==
  # yamllint disable-line rule:line-length
  - path: /etc/mactab
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluACspKs3LNlAwMLAyMrYyMrFKTLZKM7eytOQqLskvSkxPBUulGliZJFuZ
      WViZpFqlpHEBAFNDlwk0AAAA
  # static DNS config
  - path: /etc/resolv.conf
    owner: root:root
    permissions: '0644'
    encoding: ""
    content: |-
      search home.chaosengine.net
      nameserver 192.168.40.254
run_cmd:
  - "/root/provision.sh >> /root/provision.log 2>> /root/provision.err"
boot_cmd:
  # enable NFS client
  - mkdir -p /var/lib/nfs/sm
  - rc-update add rpc.statd
  - rc-update add nfsclient
  # use static network config rather than connman
  - rc-update add networking boot
  - rc-update del connman boot
  # persistent network device naming
  - nameif -s
k3os:
  modules:
    - kvm
    - nvme
  sysctl:
    kernel.printk: "4 4 1 7"
    kernel.kptr_restrict: "1"
  dns_nameservers:
    - 192.168.40.254
  ntp_servers:
    - 0.us.pool.ntp.org
    - 1.us.pool.ntp.org
  server_url: https://192.168.40.10:6443
  token: SECRETSQUIRREL
  password: "$1$ZDYMI7GJ$0F0YZRwBXP4l3CQItcXMg/"
  k3s_args:
    - server
    - "--tls-san"
    - "192.168.40.10"
    - "--tls-san"
    - "k8s.s.chaosengine.net"
    # replace with kube-vip LB
    - "--disable"
    - "servicelb"
    # replace with Cilium
    - "--flannel-backend=none"
    - "--disable-network-policy"
