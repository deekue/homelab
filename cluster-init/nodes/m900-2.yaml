---
hostname: m900-2
ssh_authorized_keys:
  - github:deekue
  - "ssh-ed25519
     AAAAC3NzaC1lZDI1NTE5AAAAIBIMWQez3DYo1jeHOOE3nG7RPllzzpKW2p2R7QwmOaoj
     apathy@chelone"
write_files:
  # yamllint disable-line rule:line-length
  - path: /root/provision.sh
    owner: root:root
    permissions: '0744'
    encoding: gz+base64
    content: |
      H4sICLn7yWICA3Byb3Zpc2lvbi5zaAC9Vl1v2zYUfbZ+xY2Szs0QWZKTDZkbp0jTtC/dEqQd9pBl
      AC1RNmGJ1EjKidHkv+9SHzYlOeuwAXuzyMtzL88599L7e/6McX9G1MLZd/ZBL5gCWXAFggNdUbmG
      mRD6CJQATmmsQAuYUWAxzXKhKdeOoho8WgjIWU4TwlLHSQWfL4Tkvyr620Kk9D1Ty2lCUkU3W+WS
      H9OVr2JircqpvyLST9nMbxadiFxSqdXU9amOfKVSPzLffkQ884MlLCKaqlEktetIOmdKy/WNFI/r
      qbvQOp/4fvjTeBT+eDo6CUbj49PJcTg+dZ3lsbqtohlt0CXh0YJKH/d8udkcrUmWug4SNMfb6gWF
      qJASbw+mgCPAI9ESWAJMDxWQVFISr4FxpUma0tgUVdZj7jF1D17j6RS8RIF70KoXr1Te4tB1EOzu
      DjxehWxOu3B/D29MCdwBk3EP5pLm4P35kMDZ6wUmBm8MZ2dnvYNPoFEd8MJD3Ko5dbdYADRaCHAv
      4pjxOdTMrKFEgMuL8qquFdiBPz+3YDEsYQ41ijfhxho0Nv6R1JC6oi/lgPPvxg4erznYA08idEut
      Ng1VgkvBEzYvpIWbG1xTDBoEOfGurj/AeQ/LGWRMSiHVxBkAxCJaUjliAr8oj3PBuC43POjKhScR
      sSy1KgF7ocjh4ucvoKhkJIVIcIUN4Dq1SKD1+vMJlFZjnGlNZvD0VF1gWO5NJpKqnDzwia9Ma6Lh
      9Bq8TxCGP4yDoAZY6TAIhoZzG2pXFkXRbCVGO8/28CaifYsYOxQSIeFT3YcbT86Qh692Iz/3XIlh
      Vow9BzB2OgVXy4K2TzXn9nYlCLuxjegAhTJ2fTD4Vc2do607QEw0cWsEyxRPkBOp0Z69mzmDXKID
      0CPLlMxoCvO8/DDx6C+WEfQZfdQnELwCFOVV5YkqgwlCD85o+Y0+wbKrnqj2PmtSDYQ6u5ftoLZA
      ceHjOyjrgERSCr/X+E9V8w8nZvXNsLvurWAYjILg47sq4MCOiAqc28kYvHiyXcUZgcIcupYe5Qj6
      uqn2+QUlTBgXuifHEV6blxOlrBytHdHRaORaDO2iHUvaSbJ7sKnErejexXTjjlhwWqcqyTedCrCP
      PQ4PFBYEZxDBdy7LsT0MAtNM8LcY0hRzg4u/FNm/lqgR4go1mtz9Mbn/frJVodEgtDSwFbD57xTU
      U8Hen3YL3HUcWfhy/f4aVJHnAlkWCCVLEgwHwEmGmo2AzoGvMhrwMA+t2Y89lRFtVG1jP8MD04tS
      qor2OovINYqYVhqaD5yLb8uAbEnH+BB6qw/g6Wofh12D6Zl+Rc4D+Ad3srurp7EB3kjcPNE96v6L
      1m21TcKe4rs1/7u++5bu/6fyDbeNCa5ub69vJxarpv8TUfDYj5BewyAufnscl+99DfyI5IathrXe
      hc6ckD02qroysjTOjJmETnjtOLPj5T2wdr72K3Sza/TZf792BJeva6LMG7/j5SryuOqgbVgzFJvh
      3buthYjz8dz6Huksb8F3qhm0oQbGngMukAksIqNHkqblDwggKIfv+Qvo2aqzbn1uddtIgW7YOSY6
      xthoY+LBI9ZH3VQ9eiu1zET/CzvQMQzFDAAA
run_cmd:
  - "/root/provision.sh >> /root/provision.log 2>> /root/provision.err"
boot_cmd:
  # enable NFS client
  - mkdir -p /var/lib/nfs/sm
  - rc-update add rpc.statd
  - rc-update add nfsclient
k3os:
  modules:
    - kvm
    - nvme
  sysctl:
    kernel.printk: "4 4 1 7"
    kernel.kptr_restrict: "1"
  dns_nameservers:
    - 192.168.40.254
  ntp_servers:
    - 0.us.pool.ntp.org
    - 1.us.pool.ntp.org
  server_url: https://192.168.40.10:6443
  token: SECRETSQUIRREL
  password: "$1$ZDYMI7GJ$0F0YZRwBXP4l3CQItcXMg/"
  k3s_args:
    - server
    - "--tls-san"
    - "192.168.40.10"
    - "--tls-san"
    - "k8s.s.chaosengine.net"
    # replace with kube-vip LB
    - "--disable"
    - "servicelb"
    # replace with Cilium
    - "--flannel-backend=none"
    - "--disable-network-policy"
