---
hostname: m900-1
ssh_authorized_keys:
  - github:deekue
  - "ssh-ed25519
     AAAAC3NzaC1lZDI1NTE5AAAAIBIMWQez3DYo1jeHOOE3nG7RPllzzpKW2p2R7QwmOaoj
     apathy@chelone"
write_files:
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-ds.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICB9I3GICA2t1YmUtdmlwLWRzLnlhbWwArVZbb9owFH7nV1g8N6y0rOryxlo0VVpRBdX2ME2V
      cQ7g4diZL1w27b/v2IEQiKnotDygcHy+8527Qwv+BbThSqZk2W0tuMxSMga95Az6jCknbSsHSzNq
      adoiRNIcUrJwE0iWvNgKTEHZTmo2xkLeSpKkRWu29YSyDnV2rjT/RS3KOotb0+HqXcV6JxxC9UgJ
      OKCkUiobIMb/JVFbSK0lWAgm8Uy5AvHoVNtqB+3K89K9dBdAoj2bdgKC7YSgz580gk1KvrXb30s+
      MMppBkFmytyY9gWp3t8Z9M8FkVQZnpW4JehJwAhubPuiPQP/u6KWzb1q6WHQPeJlSumMy3qaYq4I
      oOYUGSnZSIMO35iGktgXqZH7jyjgcnZ+9ZrtcZzkydakT/YIpqGo23hfsY1azcZ4tY7GTX4As1jK
      hEQ7+d/7lxaF2bfqPYVcyTEczkbIK2o/czRpaY7BSScEngg6AbHtXrR01K6HPiWZOaG3rAb1stPr
      9BrRlMgTAZkCmHfAgMAUKV06k/vu+Fzz7lz/0GQh/ICVZmpZ8M/pTPhHHPCdn5Fzs4JBboMNiOmU
      S243ez4/o/2G1A/XT8c1ZPdOY7eO2RwyJ/DtYSZVJR6sgTkfWx1Z2hxvU/sMOjeHx0mZ6cG6wAk2
      +1VW11jAJg12QjMfRZlTPwJHGEJUAZr6apLBGufe/F9SpqRFcYKVlnAutwdRLrEqOzbcbnpW4/Z+
      STqrhQNyWT8uy4+Vf6G6qPEuqXD1lX6oXyhtI8o3vd51O2qcS0zpFCeliUIGubiMohjPdITm+qpJ
      wooXkHQi4OwYEFHNbxNUn+eYa1kmTYRqSoWJcJkle6t7ngRvnQx0aHVsqbdCDc6UpieQ7+MwDRJW
      GdLiMMZ8vT4Fs3qDPcpVFgF1myCaZX5QmsrdD1ed7s1tp3fZ6e6bgufYwymZzZn2w7LbVtVLWltI
      lf4TrsEnJTjDseuLFd3s6RpX024rVVf+7z+V1OAW0ri/7nDaYG3rg81oQSdccMvhaOAxwOO1NBw8
      v/TvHx+GEfmo/3UrnStjh2BXSi/CbOyqYA6u12EsAItrRde/3rx1mE6xfVIyVNstuy/ria1Sx5Qr
      +FVI+bEztiiH2SZkrvxGC/e009hSduhyXHY7B/BW96XFrzd/BUTPZBA+cmNi8hE26MYLWn8Bl7PX
      iFQLAAA=
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-cloud-controller.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICFoc2mICA2t1YmUtdmlwLWNsb3VkLWNvbnRyb2xsZXIueWFtbACtVD1v2zAQ3fUrBI1F6Tjt
      UgjokARoOqRpEANdigw0ebbZUCRxJJW6Rf97j9RHlMSxXaBaJB3v3ruPd+ROfQP0ypq6bE+Le2Vk
      XS4AWyXgTAgbTSgaCFzywOuiLA1voC7v4xJYqxwT2kbJhDUBrdaAvYd3XAxufusDNAVjrOATMlxy
      MeMxbCyqXzyQbXb/wc+UPRnTuNCRQvHWaniSAzfGhhzi02+5E4uo0UCADElnNjqKp6SqgBGqsZQu
      vfrVihgmeowaMhkrqYhLJDRfl98rYS1KZab5V3ddTuBtRAHZTQP34PuTFnCZrWsI1duyEgiUWPrq
      UkxfWvl85mLIUc9od3FQyiu1brjzKRCMdFaZQD8VtNB9+G6u/sRT+2L2253Zm2NJjZWQcQbo50hd
      IV2p1QMPYkPvvs67LIoXsz4ngzLr49XyUp8Hh7rsOdJwb2GVVdXXuoeMvF4q89+E5OPyB4hAWmLl
      zmX7jyvGnfOP27SgmcMq6gUcsdEObavkPjLvQKTwfvDXB1CclV+44WtoSIs3ViuxrcuvSIcgb4HL
      bZGU5cjOSTen+a9VqY7PpCCL2yvVqEAn88ypqYcWu+1vkqqu+BJ0fx2kWbrHZHqbsI2zhtj3pUmV
      OZ2uiQ550qb06Ccku2mOJKIi+gZ2ISZwZWhwg4UlmIbT4EZcVp7sw+tcGKONJhPLLWLDsrI0xY/7
      NNU9qqER1eV6IzAt1xDwGnHdzmfz2bsx/JCWJiQ3UetBB2f6gW/9eD65YX7/6a3S+MG7X75PCn0o
      xojAMezE82IDkq5v7CQqYcWjDmw0D24gIqqwvaCmwM8woSaupr/iL5H24AZQWbkAap+kFN/PR4Tp
      Il8f2OK/cfA8FXkHAAA=
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-cloud-controller-configmap.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICKsb2mICA2NvbmZpZ21hcC55YW1sADXKPQ6DMAxA4d2n8AVISYRQ8Nq5K7shLrIgPyIpUm/f
      hY7v0+Ois5xVcyK8LOyaAuEzp7duLy4QpXHgxgSIiaMQ7p9FLi1318LrjV391iYR/vuq4ey2Iy98
      ENrJGTt6M/TGOv9wHn4QHWlKeQAAAA==
  # yamllint disable-line rule:line-length
  - path: /root/provision.sh
    owner: root:root
    permissions: '0744'
    encoding: gz+base64
    content: |
      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
  # yamllint disable-line rule:line-length
  - path: /etc/network/interfaces
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluAJ2S3W6DMAyF73kKS7suBVqmTar2BHsJN0lpBCRZflpV6sPPCQ2i1TSt
      u0DE8eHzsQ0Gr2HQhTwgE3QAqYSntzZ7ZH2BMe1tUH11k0zBJHMevWQFAHJuhXNQvzdl/fpWbquy
      pmvSjOh6aNq2zE9F9x16ccbLUt60W0oY7fwqGJAGBqn6yJ0Ot6oKx+ygrCsAfzECTgMqkBzixfUa
      0+JJ1OYRtfk3qq6qR1fVLyhHU1z0Q5k/aTdPaKOBhTZt1HltsRN5pzmctjqiCjgQ9AVM8HAk9Lxg
      rQBJwFJ3UyWdFLvVB9PKIxEsnLXtXQJY8RWkFRwO2sKnVt1RW7WWjjmJfKR6XlhkXmpVpI6W/mdX
      wdwn4/zdUY6rWTF9k6M0/2xy1FzA3kreiZkSu0mU/AO2NKZ1swUuTvfkH1zdFSZr37j2lLlCAwAA
  # yamllint disable-line rule:line-length
  - path: /etc/mactab
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluACspKs3LNlAwMLAyMrYyMrFKMrNKNLEySuQqLskvSkxPBUulGliZJFuZ
      WVgZGViZGXABAEQ70k80AAAA
  # static DNS config
  - path: /etc/resolv.conf
    owner: root:root
    permissions: '0644'
    encoding: ""
    content: |-
      search home.chaosengine.net
      nameserver 192.168.40.254
run_cmd:
  - "/root/provision.sh >> /root/provision.log 2>> /root/provision.err"
boot_cmd:
  # enable NFS client
  - mkdir -p /var/lib/nfs/sm
  - rc-update add rpc.statd
  - rc-update add nfsclient
  # use static network config rather than connman
  - rc-update add networking boot
  - rc-update del connman boot
  # persistent network device naming
  - nameif -s
k3os:
  modules:
    - kvm
    - nvme
  sysctl:
    kernel.printk: "4 4 1 7"
    kernel.kptr_restrict: "1"
  dns_nameservers:
    - 192.168.40.254
  ntp_servers:
    - 0.us.pool.ntp.org
    - 1.us.pool.ntp.org
  token: SECRETSQUIRREL
  password: "$1$ZDYMI7GJ$0F0YZRwBXP4l3CQItcXMg/"
  k3s_args:
    - server
    - "--cluster-init"
    - "--tls-san"
    - "192.168.40.10"
    - "--tls-san"
    - "k8s.s.chaosengine.net"
    # replace with kube-vip LB
    - "--disable"
    - "servicelb"
    # replace with Cilium
    - "--flannel-backend=none"
    - "--disable-network-policy"
