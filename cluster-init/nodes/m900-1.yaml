---
hostname: m900-1
ssh_authorized_keys:
  - github:deekue
  - "ssh-ed25519
     AAAAC3NzaC1lZDI1NTE5AAAAIBIMWQez3DYo1jeHOOE3nG7RPllzzpKW2p2R7QwmOaoj
     apathy@chelone"
write_files:
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-ds.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICGTR0WICA2t1YmUtdmlwLWRzLnlhbWwArVZbb9owFH7nV1g8N6y0rOryxlo0VVpRBdX2ME2V
      cQ7g4diZL1w27b/vOIFgiKnotDygcHy+8527Qwv+BbThSqZk2W0tuMxSMga95Az6jCknbSsHSzNq
      adoiRNIcUrJwE0iWvNgKTEHZTmo2xkLeSpKkRQPbekJZhzo7V5r/ohZlncWt6XD1rma9Ew6heqQE
      HFBSKZUtIcb/JVFbSK0lWChN4plyBeLRqbbVDtq155V76S6ARHs27QSUthOCPn/SCDYp+dZuf6/4
      wCinGZQyU+XGtC9I/f7OoH+uFEmV4VmFW4KelBjBjW1ftGfgf1fUsrlXrTwsdY94mVI64zJMU8wV
      AdScIiMVG2nQ4RvTUBH7IjVy/xEFXM7Or16zPY6TPNma9MkewbQs6jbeV2yjVrMxXq2jcZMfwCyW
      MiHRTv73/qVFYfatek8hV3IMh7NR5hW1nzmatDTH4KQTAk8EnYDYdi9aOmrXQ5+SzJzQW9aDetnp
      dXqNaCrkiYBMAcw7YEBgipSunMl9d3wOvDvXPzRZCD9glZkgC/45nQn/iAO+8zNyblYwyG2wJWI6
      5ZLbzZ7Pz2i/IfXD9dNxDdm909itYzaHzAl8e5hJVYsHa2DOxxYiK5vjbWqfQefm8DipMj1YFzjB
      Zr/KQo0FbNLSTtnMR1Hm1I/AEYYQVYCmvppksMa5N/+XlClpUZxgpSWcy+1BlEusyo4Nt5ueBdze
      L0lnQTggl+FxVX6s/AvVRcC7pMKFK/1Qv1DaRpRver3rdtQ4l5jSKU5KEwV2jt10GYUxnukIz/VV
      k4UVLyDpRMDZQSCiHuAmKBzomGtZJk2EakqFiXCZJXure54Er50MdNnr2FNvhRocKk1PIN/HYRok
      rDKkxWmM+Xp9Cmb1BpuUqywC6jZBNMv8pDSVux+uOt2bW+yITnffFDzHJk7JbM60n5bduqpf0mAj
      1fpPuAeflOAM564vVnSzp2vcTbu1VN/5v//UUoNrSOMCu8Nxg7UNJ5vRgk644JbD0cRjgMd7aTh4
      funfPz4MI/JR/+tWOlfGDsGulF6kxNe3tfMivF+HsQAs7hUdfr556zCdYvukZKi2a3Zf1hNrJcRU
      O/hVSPW1M7Yoh9mmzFz1kVZe1E5jS9mhy3Hb7RzAa92XFj/f/B0QPZOl8JEbE5OPsEE3XtD6Cycy
      TxxVCwAA
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-cloud-controller.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICIbR0WICA2t1YmUtdmlwLWNsb3VkLWNvbnRyb2xsZXIueWFtbACtVD1v2zAQ3fUrBI1F6Tjt
      UgjokARoOqRpEANdigw0ebbZUCRxJJW6Rf97j9RHlMSxXaBaJB3v3ruPd+ROfQP0ypq6bE+Le2Vk
      XS4AWyXgTAgbTSgaCFzywOuiLA1voC7v4xJYqxwT2kbJhDUBrdaAvYd3XAxufusDNAVjrOATMlxy
      MeMxbCyqXzyQbXb/wc+UPRnTuNCRQvHWaniSAzfGhhzi02+5E4uo0UCADElnNjqKp6SqgBGqsZQu
      vfrVihgmeowaMhkrqYhLJDRfl98rYS1KZab5V3ddTuBtRAHZTQP34PuTFnCZrWsI1duyEgiUWPrq
      UkxfWvl85mLIUc9od3FQyiu1brjzKRCMdFaZQD8VtNB9+G6u/sRT+2L2253Zm2NJjZWQcQbo50hd
      IV2p1QMPYkPvvs67LIoXsz4ngzLr49XyUp8Hh7rsOdJwb2GVVdXXuoeMvF4q89+E5OPyB4hAWmLl
      zmX7jyvGnfOP27SgmcMq6gUcsdEObavkPjLvQKTwfvDXB1CclV+44WtoSIs3ViuxrcuvSIcgb4HL
      bZGU5cjOSTen+a9VqY7PpCCL2yvVqEAn88ypqYcWu+1vkqqu+BJ0fx2kWbrHZHqbsI2zhtj3pUmV
      OZ2uiQ550qb06Ccku2mOJKIi+gZ2ISZwZWhwg4UlmIbT4EZcVp7sw+tcGKONJhPLLWLDsrI0xY/7
      NNU9qqER1eV6IzAt1xDwGnHdzmfz2bsx/JCWJiQ3UetBB2f6gW/9eD65YX7/6a3S+MG7X75PCn0o
      xojAMezE82IDkq5v7CQqYcWjDmw0D24gIqqwvaCmwM8woSaupr/iL5H24AZQWbkAap+kFN/PR4Tp
      Il8f2OK/cfA8FXkHAAA=
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-cloud-controller-configmap.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICL9krWICA2NvbmZpZ21hcC55YW1sADXKPQ6DMAxA4d2n8AVISYRQ8Nq5K7shLrIgPyIpUm/f
      hY7v0+Ois5xVcyK8LOyaAuEzp7duLy4QpXHgxgSIiaMQ7p9FLi1318LrjV391iYR/vuq4ey2Iy98
      ENrJGTt6M/TGOv9wHn4QHWlKeQAAAA==
  # yamllint disable-line rule:line-length
  - path: /root/provision.sh
    owner: root:root
    permissions: '0744'
    encoding: gz+base64
    content: |
      H4sICP5P0mICA3Byb3Zpc2lvbi5zaAC9Vl1v2zYUfY5+xY0SL0kXfdhNh8yNXaRp2j20S5B0GIYs
      A2iJsglLpEpSTowk/32XlGxLlrMOGbAnm+Tl/Tjn3kPtbAcjxoMRURNnx9kBPWEKZMEVCA50RuUc
      RkLoQ1ACOKWxAi1gRIHFNMuFplw7imrwaCEgZzlNCEsdJxV8PBGS/6bo7xOR0g9MTQcJSRVdHtmt
      IKazQMWktisHwYzIIGWjYLHpROSMSq0GbkB1FCiVBpFZBxHxzB+WsIhoqvxIateRdMyUlvNLKe7n
      A3eidd4Pgu7PPb/707F/FPpvev3X3d6x60xfq6vSmNGFc0l4NKEywLNALg/9OclS13GSgkeaITKp
      GMODA/gbkRQ8CZkaD9zdV2gDQKOJAHd3P8ak4MfOH52sE3udXzpfOtcHsIuWrvPkINZjBE5PKESF
      lAgkmFoOAcNHU2AJML2ngKSSkngOjCtN0pTGpj5bmoEEQ+7jbcwgURixUTqiYwE5cB10dnMDHi9N
      lrdduL2FtyYFjlmj0TaMJc3B+3aXwMn+BAOD14OTk5PWxUfQSDR43QM8quhxV77AAuSexjHjY6hA
      noN1AGentlLX2lVYNb0PhzWvaJYwh5reqdyaHqOxaURJDT0z+lwIGP7Qc/B2hcC2YcrdbfDeBMH6
      PxM8YeNC1tzmxq1JBRsNAfHOLz7CsOXK2cqYlEKqvrMFEItoSqXPhF1hqTzOBeO6WgJ4sM6Za47G
      k+gFt74VZP6CWC8JNT1W/gsuImaWC4sxikaRw+mXr6CoZDhDkeAKlcJ1qhYErefXR2CHknGmNRnB
      42PZL3v2rN+XVOXkjvcDZTQMx0nPwfsM3e6bXhhWDma6G4Z7pqXqrjZFURRHyfpoxlldXlo0iohR
      ySAREj5XerUcuBGi8FAXvKfWyKFZzaaul2g7GICrZUGbtxb3tjcF6K7bVj0NUCgzi3fGfZny2s1G
      CYDaRdzKQa3nHyEnUuPwtQpztnKJLYAjME3JiKYwzu3C2OP4sIzgGNF7fQRhB5CSTtkQZQRjhCM2
      onaNTYI9VQ58eXatSSl2VXQv24BsgdTCp/dg84BEUgp/Vv4fS2Hb65vdt3vr+94M9kI/DD+9Lw12
      6xZRgc9b0gMv7q92Uf+QlwO3RoeV14dltk/PEMGFblFxiCVzK5U2a2zqiPq+79bQ2QQ5prMRYHd3
      mYVbQr0J5SqfWHBaRbK4mwkF2EH1gjsKE4LiSvBLIMtxLowDZt6/d1Yqy1wucfPXInsxOwsOzpGe
      /s1f/dtX/RUBC/i7Nfjr4NehX0uoRUD9fLCe4KbriMLXiw8XoIo8FwiyQFfSgmC/ATjJkDIf6Bj4
      LKMh7+bd1duH05QRbThtun6CO6YnlqgS9SqIyDVSmJYMmgXq4TtrkE1pD593b/YRPF2eo8gtfHpm
      UhHyEP5FSfW5alFsHC8ZXnx4tJD7L1Q3yTYBW4RvpvyfJu57tP+PxC+xrXrg/Orq4qpfA9UMfyIK
      HgcRomsAxM3v67D9jCn90nvEttsY19p7sCYScsMMYFoZmZq+jJmENeuq38yJl7d8NcM1H5/LTZJX
      /6TcYGzf1ESZl72tk0Uel+Ozslro4UKzW7XWHKI0DmtrX2f5AsHyi7OZzFbT1ZbpzS0uEAhMIqOH
      kqb2D4QQWt0dPuM9m63t15Yr1hZEYCtslIi1rlgyY+zBI7VFNVAtcEuujJj/DVof1iviDQAA
  # yamllint disable-line rule:line-length
  - path: /etc/network/interfaces
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluAJ2RXQ6DIBCE3z3FnsCAStMeZ6u0ISgSgTYmHr6LaGpNk/48ENidLzNZ
      FoPvoe0zdcFa0gOUkZ7u3p6x1hlG2Q/BaLYgqUhYhyZgmwEEC8pCq4wGR/2FCfZVwqZJj0U32K1+
      OWcAfrQSbi0aUA3ExjRFWX7vUu5dyn9cqr1L9Y8LZ2w/EXvv8vyy+RtI+YSV32ExcYNtlkkzvuwz
      zjyv1Hn0qiZHGm2QzgE/FTk/HAnIObWJ6dBpKITI18Oof0Uv7zhu8UJUKdL5fsCrXBPX8kOg+C1Q
      pMAHKSAhl9ACAAA=
  # yamllint disable-line rule:line-length
  - path: /etc/mactab
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluACspKs3LNlAwMLAyMrYyMrFKMrNKNLEySuQqLskvSkxPBUulGliZJFuZ
      WVgZGViZGXABAEQ70k80AAAA
  # static DNS config
  - path: /etc/resolv.conf
    owner: root:root
    permissions: '0644'
    encoding: ""
    content: |-
      search home.chaosengine.net
      nameserver 192.168.40.254
run_cmd:
  - "/root/provision.sh >> /root/provision.log 2>> /root/provision.err"
boot_cmd:
  # enable NFS client
  - mkdir -p /var/lib/nfs/sm
  - rc-update add rpc.statd
  - rc-update add nfsclient
  # use static network config rather than connman
  - rc-update add networking boot
  - rc-update del connman boot
  # persistent network device naming
  - nameif -s
k3os:
  modules:
    - kvm
    - nvme
  sysctl:
    kernel.printk: "4 4 1 7"
    kernel.kptr_restrict: "1"
  dns_nameservers:
    - 192.168.40.254
  ntp_servers:
    - 0.us.pool.ntp.org
    - 1.us.pool.ntp.org
  token: SECRETSQUIRREL
  password: "$1$ZDYMI7GJ$0F0YZRwBXP4l3CQItcXMg/"
  k3s_args:
    - server
    - "--cluster-init"
    - "--tls-san"
    - "192.168.40.10"
    - "--tls-san"
    - "k8s.s.chaosengine.net"
    # replace with kube-vip LB
    - "--disable"
    - "servicelb"
    # replace with Cilium
    - "--flannel-backend=none"
    - "--disable-network-policy"
