---
hostname: m900-1
ssh_authorized_keys:
  - github:deekue
  - "ssh-ed25519
     AAAAC3NzaC1lZDI1NTE5AAAAIBIMWQez3DYo1jeHOOE3nG7RPllzzpKW2p2R7QwmOaoj
     apathy@chelone"
write_files:
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-ds.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICGTR0WICA2t1YmUtdmlwLWRzLnlhbWwArVZbb9owFH7nV1g8N6y0rOryxlo0VVpRBdX2ME2V
      cQ7g4diZL1w27b/vOIFgiKnotDygcHy+8527Qwv+BbThSqZk2W0tuMxSMga95Az6jCknbSsHSzNq
      adoiRNIcUrJwE0iWvNgKTEHZTmo2xkLeSpKkRQPbekJZhzo7V5r/ohZlncWt6XD1rma9Ew6heqQE
      HFBSKZUtIcb/JVFbSK0lWChN4plyBeLRqbbVDtq155V76S6ARHs27QSUthOCPn/SCDYp+dZuf6/4
      wCinGZQyU+XGtC9I/f7OoH+uFEmV4VmFW4KelBjBjW1ftGfgf1fUsrlXrTwsdY94mVI64zJMU8wV
      AdScIiMVG2nQ4RvTUBH7IjVy/xEFXM7Or16zPY6TPNma9MkewbQs6jbeV2yjVrMxXq2jcZMfwCyW
      MiHRTv73/qVFYfatek8hV3IMh7NR5hW1nzmatDTH4KQTAk8EnYDYdi9aOmrXQ5+SzJzQW9aDetnp
      dXqNaCrkiYBMAcw7YEBgipSunMl9d3wOvDvXPzRZCD9glZkgC/45nQn/iAO+8zNyblYwyG2wJWI6
      5ZLbzZ7Pz2i/IfXD9dNxDdm909itYzaHzAl8e5hJVYsHa2DOxxYiK5vjbWqfQefm8DipMj1YFzjB
      Zr/KQo0FbNLSTtnMR1Hm1I/AEYYQVYCmvppksMa5N/+XlClpUZxgpSWcy+1BlEusyo4Nt5ueBdze
      L0lnQTggl+FxVX6s/AvVRcC7pMKFK/1Qv1DaRpRver3rdtQ4l5jSKU5KEwV2jt10GYUxnukIz/VV
      k4UVLyDpRMDZQSCiHuAmKBzomGtZJk2EakqFiXCZJXure54Er50MdNnr2FNvhRocKk1PIN/HYRok
      rDKkxWmM+Xp9Cmb1BpuUqywC6jZBNMv8pDSVux+uOt2bW+yITnffFDzHJk7JbM60n5bduqpf0mAj
      1fpPuAeflOAM564vVnSzp2vcTbu1VN/5v//UUoNrSOMCu8Nxg7UNJ5vRgk644JbD0cRjgMd7aTh4
      funfPz4MI/JR/+tWOlfGDsGulF6kxNe3tfMivF+HsQAs7hUdfr556zCdYvukZKi2a3Zf1hNrJcRU
      O/hVSPW1M7Yoh9mmzFz1kVZe1E5jS9mhy3Hb7RzAa92XFj/f/B0QPZOl8JEbE5OPsEE3XtD6Cycy
      TxxVCwAA
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-cloud-controller.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICIbR0WICA2t1YmUtdmlwLWNsb3VkLWNvbnRyb2xsZXIueWFtbACtVD1v2zAQ3fUrBI1F6Tjt
      UgjokARoOqRpEANdigw0ebbZUCRxJJW6Rf97j9RHlMSxXaBaJB3v3ruPd+ROfQP0ypq6bE+Le2Vk
      XS4AWyXgTAgbTSgaCFzywOuiLA1voC7v4xJYqxwT2kbJhDUBrdaAvYd3XAxufusDNAVjrOATMlxy
      MeMxbCyqXzyQbXb/wc+UPRnTuNCRQvHWaniSAzfGhhzi02+5E4uo0UCADElnNjqKp6SqgBGqsZQu
      vfrVihgmeowaMhkrqYhLJDRfl98rYS1KZab5V3ddTuBtRAHZTQP34PuTFnCZrWsI1duyEgiUWPrq
      UkxfWvl85mLIUc9od3FQyiu1brjzKRCMdFaZQD8VtNB9+G6u/sRT+2L2253Zm2NJjZWQcQbo50hd
      IV2p1QMPYkPvvs67LIoXsz4ngzLr49XyUp8Hh7rsOdJwb2GVVdXXuoeMvF4q89+E5OPyB4hAWmLl
      zmX7jyvGnfOP27SgmcMq6gUcsdEObavkPjLvQKTwfvDXB1CclV+44WtoSIs3ViuxrcuvSIcgb4HL
      bZGU5cjOSTen+a9VqY7PpCCL2yvVqEAn88ypqYcWu+1vkqqu+BJ0fx2kWbrHZHqbsI2zhtj3pUmV
      OZ2uiQ550qb06Ccku2mOJKIi+gZ2ISZwZWhwg4UlmIbT4EZcVp7sw+tcGKONJhPLLWLDsrI0xY/7
      NNU9qqER1eV6IzAt1xDwGnHdzmfz2bsx/JCWJiQ3UetBB2f6gW/9eD65YX7/6a3S+MG7X75PCn0o
      xojAMezE82IDkq5v7CQqYcWjDmw0D24gIqqwvaCmwM8woSaupr/iL5H24AZQWbkAap+kFN/PR4Tp
      Il8f2OK/cfA8FXkHAAA=
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-cloud-controller-configmap.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICL9krWICA2NvbmZpZ21hcC55YW1sADXKPQ6DMAxA4d2n8AVISYRQ8Nq5K7shLrIgPyIpUm/f
      hY7v0+Ois5xVcyK8LOyaAuEzp7duLy4QpXHgxgSIiaMQ7p9FLi1318LrjV391iYR/vuq4ey2Iy98
      ENrJGTt6M/TGOv9wHn4QHWlKeQAAAA==
  # yamllint disable-line rule:line-length
  - path: /root/provision.sh
    owner: root:root
    permissions: '0744'
    encoding: gz+base64
    content: |
      H4sICGaDz2ICA3Byb3Zpc2lvbi5zaAC9Vtty2zYQfRa/Yk07UdwxL1KcjqtYzjiOkxc39jhp++C6
      MxAJShiRAAOAsjWx/70LXiRQlJuOO9M3Alic3T1nd8HdnWDCeDAhaubsOrugZ0yBLLgCwYEuqFzC
      RAh9AEoApzRWoAVMKLCYZrnQlGtHUQ0eLQTkLKcJYanjpIJPZ0Ly3xT9YyZS+oGp+TghqaKro3Ir
      iOkiUDGxduU4WBAZpGwSNJtORM6o1GrsBlRHgVJpEJl1EBHPfLCERURT5UdSu46kU6a0XF5Jcb8c
      uzOt81EQDH4Z+oOfj/zD0H8zHL0eDI9cZ/5aXVfGjDbgkvBoRmWAZ4FcHfpLkqWug/xgskUOv1+c
      fgbGNZUJiahyzMkUadAzClEhJdICJrIDQLBoDiwBpvsKSCopiZd4VWmSpjQ20ZaBmgTH7t4rvJ2C
      lyhw91qJYK5levuug2A3N+DxymR124XbW3hrQuAOGI87MJU0B+/bXQLHr2boGLwhHB8fdy4+gEbZ
      wBvs41FNtrvGAqDRTIB7GseMT6HmbAklApydlqm6luEG/MmJBYtmCXOoKYXG3NQMjU1hSWroXtCn
      fMDJy6GD12sOdsCTCN3SsU1D5eBM8IRNC2nh5gbXBIOVg5x455cf4aSD5fQyJqWQauT0AGIRzan0
      mShXCM7jXGAV1EsADzZlc83RdBY949a3giyf4es5ruZHyn/GReSsFKMiueqM01+/Yo9IRlKIBFfY
      +65TlyFovfxyCGWbMc60JhN4eKgk6pdno5GkKid3fBQoM5WwpfQSvAsYDN4Mw7AGWOhBGPZNVdlQ
      27woiu1UYrT9rC+vLNpZxDicIBESLuoRtOq6CfLw3Z5hj52+QzPLxh6BaDseg6tlQdu3mns72xwM
      Nm2bsgYolGnIO4NfxbxxtZUDxEQTt0awyv4BciI1NmAnM6eXS6wC7IJ5SiY0hWleLow9dhDLCHYS
      vdeHEL4AFOVFVROVB2OEXTah5RrrBMOuur46+6JJNfJq7162hdoCxYVP76GMAxJJKfxZ4z9U460/
      Mrtv+5v73gL6oR+Gn95XBnu2RVTgk5UMwYtH612cgijMvmvpUQ7Z76toH59QwphxoTtyHGDavJyZ
      ZeRY2hH1fd+1GNpGO4a0lWR3bxWJW9G9jemmOmLBae2qJN90KsAuTjG4ozAjOGUJPvFZju1hEJhm
      gr9DkyaYK9z8XGTPlqgR4hw1Gt38Nbr9abRWodFgYGlgK2DzvxFQRwX7fLwZ4LbryMLXyw+XoIo8
      F8iyQChZkmA4AE4y1MwHOgW+yGjIB/nAet2wpzKijapt7Ee4Y3pWSlXRXnsRuUYR00pDs8C5+K40
      yOZ0iE+9t/gInq7Ocdg1mJ7pV+Q8hH+Rk91dHY0N8Eri5iekQ91/0bqttnHYUXy75v/Udz/S/f9U
      vuG2KYLz6+vL65HFqun/RBQ8DiKk1zCImz8ex+UfTQ18j+QOWg1rvQsbc0J22KjiysjcVGbMJGyY
      1xVnTry8A9b2136FrraNPvsHc4tx+bomyrzxW16uIo+rDlqbNUOxGd6dbC1EnI8n1trXWd6C34im
      14bqmfLscYFMYBAZPZA0LT8ghLAcvidPoGeLjX1rudZtJQVWw9YxsVEYK22MPXjEWtRN1aG3UstM
      9L8Bkxk0LcANAAA=
  # yamllint disable-line rule:line-length
  - path: /etc/network/interfaces
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluAJWRUQ6CMBBE/znFnoC0QI0eZ4WqDVAa2mpIOLxbEERiFD4Im9mXmUwX
      vWugaiJ1wVzSAEpLR//GnDEvIwxr6W7sBYRxRGrUHqsIwBtQBiqlS7CkD4Q3nwssinEYthrr0Snm
      DMB1RsK9Qg2qgCD0PbjWy20O6doh3euQrR2yvQ6csXUL9t1heqChOOm/oXQLFLIW0Hww6rW4WWg5
      nM06dConLyrTSmuBn5KYH44ExJxkYmq0JSRCxNPHSL+ikw/slngisjmOv7P4nyCxL0iMQU88gxdD
      qAIAAA==
  # static DNS config
  - path: /etc/resolv.conf
    owner: root:root
    permissions: '0644'
    encoding: ""
    content: |-
      search home.chaosengine.net
      nameserver 192.168.40.254
run_cmd:
  - "/root/provision.sh >> /root/provision.log 2>> /root/provision.err"
boot_cmd:
  # enable NFS client
  - mkdir -p /var/lib/nfs/sm
  - rc-update add rpc.statd
  - rc-update add nfsclient
  # use static network config rather than connman
  - rc-update add networking boot
  - rc-update del connman boot
k3os:
  modules:
    - kvm
    - nvme
  sysctl:
    kernel.printk: "4 4 1 7"
    kernel.kptr_restrict: "1"
  dns_nameservers:
    - 192.168.40.254
  ntp_servers:
    - 0.us.pool.ntp.org
    - 1.us.pool.ntp.org
  token: SECRETSQUIRREL
  password: "$1$ZDYMI7GJ$0F0YZRwBXP4l3CQItcXMg/"
  k3s_args:
    - server
    - "--cluster-init"
    - "--tls-san"
    - "192.168.40.10"
    - "--tls-san"
    - "k8s.s.chaosengine.net"
    # replace with kube-vip LB
    - "--disable"
    - "servicelb"
    # replace with Cilium
    - "--flannel-backend=none"
    - "--disable-network-policy"
