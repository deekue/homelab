---
hostname: m900-1
ssh_authorized_keys:
  - github:deekue
  - "ssh-ed25519
     AAAAC3NzaC1lZDI1NTE5AAAAIBIMWQez3DYo1jeHOOE3nG7RPllzzpKW2p2R7QwmOaoj
     apathy@chelone"
write_files:
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-ds.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICMRb0mICA2t1YmUtdmlwLWRzLnlhbWwArVZbb9owFH7nV1g8N6y0rOryxlo0VVpRBdX2ME2V
      cQ7g4diZL1w27b/v2IEQiKnotDygcHy+8527Qwv+BbThSqZk2W0tuMxSMga95Az6jCknbSsHSzNq
      adoiRNIcUrJwE0iWvNgKTEHZTmo2xkLeSpKkRWu29YSyDnV2rjT/RS3KOotb0+HqXcV6JxxC9UgJ
      OKCkUiobIMb/JVFbSK0lWAgm8Uy5AvHoVNtqB+3K89K9dBdAoj2bdgKC7YSgz580gk1KvrXb30s+
      MMppBkFmytyY9gWp3t8Z9M8FkVQZnpW4JehJwAhubPuiPQP/u6KWzb1q6WHQPeJlSumMy3qaYq4I
      oOYUGSnZSIMO35iGktgXqZH7jyjgcnZ+9ZrtcZzkydakT/YIpqGo23hfsY1azcZ4tY7GTX4As1jK
      hEQ7+d/7lxaF2bfqPYVcyTEczkbIK2o/czRpaY7BSScEngg6AbHtXrR01K6HPiWZOaG3rAb1stPr
      9BrRlMgTAZkCmHfAgMAUKV06k/vu+Fzz7lz/0GQh/ICVZmpZ8M/pTPhHHPCdn5Fzs4JBboMNiOmU
      S243ez4/o/2G1A/XT8c1ZPdOY7eO2RwyJ/DtYSZVJR6sgTkfWx1Z2hxvU/sMOjeHx0mZ6cG6wAk2
      +1VW11jAJg12QjMfRZlTPwJHGEJUAZr6apLBGufe/F9SpqRFcYKVlnAutwdRLrEqOzbcbnpW4/Z+
      STqrhQNyWT8uy4+Vf6G6qPEuqXD1lX6oXyhtI8o3vd51O2qcS0zpFCeliUIGucB+uowCGc90hOn6
      qsnDiheQdCLg7DAQUY1wE1Qf6ZhrWSZNhGpKhYlwmSV7q3ueBC+eDHToduyqt0INjpWmJ5Dv4zAN
      ElYZ0uI8xny9PgWzeoNtylUWAXWbIJplflaayt0PV53uzS12RKe7bwqeYxunZDZn2s/LbmFVL2lt
      J1X6T7gJn5TgDCevL1Z0s6dr3E67xVTd+r//VFKDi0jjCrvDgYO1rc82owWdcMEth6OZxwCPN9Nw
      8PzSv398GEbko/7XrXSujB2CXSm9COOxq4I5uGGHsQAsbhZd/4Dz1mE6xfZJyVBtF+2+rCcWSx1T
      buFXIeX3ztiiHGabkLnyMy1c1U5jS9mhy3Hf7RzAi92XFj/g/C0QPZNB+MiNiclH2KAbL2j9BS1I
      M1FXCwAA
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-cloud-controller.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICIbR0WICA2t1YmUtdmlwLWNsb3VkLWNvbnRyb2xsZXIueWFtbACtVD1v2zAQ3fUrBI1F6Tjt
      UgjokARoOqRpEANdigw0ebbZUCRxJJW6Rf97j9RHlMSxXaBaJB3v3ruPd+ROfQP0ypq6bE+Le2Vk
      XS4AWyXgTAgbTSgaCFzywOuiLA1voC7v4xJYqxwT2kbJhDUBrdaAvYd3XAxufusDNAVjrOATMlxy
      MeMxbCyqXzyQbXb/wc+UPRnTuNCRQvHWaniSAzfGhhzi02+5E4uo0UCADElnNjqKp6SqgBGqsZQu
      vfrVihgmeowaMhkrqYhLJDRfl98rYS1KZab5V3ddTuBtRAHZTQP34PuTFnCZrWsI1duyEgiUWPrq
      UkxfWvl85mLIUc9od3FQyiu1brjzKRCMdFaZQD8VtNB9+G6u/sRT+2L2253Zm2NJjZWQcQbo50hd
      IV2p1QMPYkPvvs67LIoXsz4ngzLr49XyUp8Hh7rsOdJwb2GVVdXXuoeMvF4q89+E5OPyB4hAWmLl
      zmX7jyvGnfOP27SgmcMq6gUcsdEObavkPjLvQKTwfvDXB1CclV+44WtoSIs3ViuxrcuvSIcgb4HL
      bZGU5cjOSTen+a9VqY7PpCCL2yvVqEAn88ypqYcWu+1vkqqu+BJ0fx2kWbrHZHqbsI2zhtj3pUmV
      OZ2uiQ550qb06Ccku2mOJKIi+gZ2ISZwZWhwg4UlmIbT4EZcVp7sw+tcGKONJhPLLWLDsrI0xY/7
      NNU9qqER1eV6IzAt1xDwGnHdzmfz2bsx/JCWJiQ3UetBB2f6gW/9eD65YX7/6a3S+MG7X75PCn0o
      xojAMezE82IDkq5v7CQqYcWjDmw0D24gIqqwvaCmwM8woSaupr/iL5H24AZQWbkAap+kFN/PR4Tp
      Il8f2OK/cfA8FXkHAAA=
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-cloud-controller-configmap.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICL9krWICA2NvbmZpZ21hcC55YW1sADXKPQ6DMAxA4d2n8AVISYRQ8Nq5K7shLrIgPyIpUm/f
      hY7v0+Ois5xVcyK8LOyaAuEzp7duLy4QpXHgxgSIiaMQ7p9FLi1318LrjV391iYR/vuq4ey2Iy98
      ENrJGTt6M/TGOv9wHn4QHWlKeQAAAA==
  # yamllint disable-line rule:line-length
  - path: /root/provision.sh
    owner: root:root
    permissions: '0744'
    encoding: gz+base64
    content: |
      H4sICOpz0mICA3Byb3Zpc2lvbi5zaAC9Vl1T20YUfUa/4iLsAin6sEM61MFkCCHpQ1IYSKfToenM
      WlrZO5Z2ld2VwQP8995dybZkmaahM+UF7+7d+3HOvWe1sx2MGA9GRE2cHWcH9IQpkAVXIDjQGZVz
      GAmhD0AJ4JTGCrSAEQUW0ywXmnLtKKrBo4WAnOU0ISx1nFTw8URI/puiv09ESt8xNR0mJFV0eWS3
      gpjOAhWT2q4cBjMig5SNgsWmE5EzKrUaugHVUaBUGkRmHUTEMz9YwiKiqfIjqV1H0jFTWs4vpbib
      D92J1vkgCHo/9/3eT0f+Yei/6g9e9vpHrjN9qa5KY0YXziXh0YTKAM8CuTz05yRLXcdJCh5phsik
      Ygz3DuD/iKTgScjUeOh2XqANAI0mAtzOXoxJwY/dP7pZN/a6v3Q/da/3oYOWrvPoINZjBE5PKESF
      lAgkmFoOAMNHU2AJML2rgKSSkngOjCtN0pTGpj5bmoEEQ+7hbcwgURixUTqiYwHZdx10dnMDHi9N
      lrdd+PIFXpsUOGaNRtswljQH7+ttAsd7EwwMXh+Oj49bFx9AI9Hg9fbxqKLHXfkCC5B7GseMj6EC
      eQ7WAZyd2kpda1dh1fR+clLzimYJc6jpncqt6TEam0aU1NAzo0+FgJMf+g7erhDYNky5nQbvTRCs
      /zPBEzYuZM1tbtyaVLDREBDv/OI9nLRcOVsZk1JINXC2AGIRTan0mbArLJXHuWBcV0sAD9Y5c83R
      eBI949bXgsyfEes5oaZHyv/+i7D869w3jnZ2qhl9/K48kAJLraUMNajI4fTTZ1BUMhzJSHCFwuM6
      VUeD1vPrQ7AzzjjTmozg4aFsv117NhhIqnJyyweBMpKI06nn4H2EXu9VPwwrBzPdC8Nd06F1V5ui
      KIqTaX0046wuLy0aRcQojJAICR8r+VvO7whRuK/r52NrgtGsZlOXX7QdDsHVsqDNW4t725sC9NZt
      qxEBKJQZ7Vvjvkx57WajBEApJIsWqI3QA+REapzlVmHOVi6xBXCipikZ0RTGuV0Ye5xGlhGcSnqn
      DyHsAlLSLRuijGCMcGJH1K6xSbCnSv0oz641KbWziu5lG5AtkFr48BZsHpBISuHPyv9DqZO7A7P7
      end935vBbuiH4Ye3pUGnbhEV+FomffDiwWoX5RR52XdrdFi1vl9m+/gEEVzoFhUHWDK3ymuzxqaO
      qO/7bg2dTZBjOhsBdjvLLNwS6k0oV/nEgtMqksXdTCjADooh3FKYENRqgh8WWY5zYRww85y+scpb
      5nKJm78W2bPZWXBwjvQMbv4afHkxWBGwgL9Xg78Ofh36tYRaBNTPh+sJbrqOKHy+eHcBqshzgSAL
      dCUtCPaTgpMMKfOBjoHPMhryXt5bPaU4TRnRhtOm60e4ZXpiiSpRr4KIXCOFacmgWaAevrEG2ZT2
      8WvBm70HT5fnKHILn56ZVIQ8hH9RUn2uWhQbx0uGF98xLeT+C9VNsk3AFuGbKf+nifsW7f8j8Uts
      qx44v7q6uBrUQDXDn4iCx0GE6BoAcfPbOmy/ikq/9A6x7TXGtfYerImE3DADmFZGpqYvYyZhzbrq
      N3Pi5S1fzXDNx+dyk+TVv1A3GNs3NVHmZW/rZJHH5fisrBZ6uNDsVq01hyiNJ7W1r7N8gWD5AdtM
      Zqvpasv05hYXCAQmkdEDSVP7A0IIre6ePOE9m63t15Yr1hZEYCtslIi1rlgyY+zBI7VFNVAtcEuu
      jJj/DQKAL2AxDgAA
  # yamllint disable-line rule:line-length
  - path: /etc/network/interfaces
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluAJ2RXQ6DIBCE3z3FnsCAStMeZ6u0ISgSgTYmHr6LaGpNk/48ENidLzNZ
      FoPvoe0zdcFa0gOUkZ7u3p6x1hlG2Q/BaLYgqUhYhyZgmwEEC8pCq4wGR/2FCfZVwqZJj0U32K1+
      OWcAfrQSbi0aUA3ExjRFWX7vUu5dyn9cqr1L9Y8LZ2w/EXvv8vyy+RtI+YSV32ExcYNtlkkzvuwz
      zjyv1Hn0qiZHGm2QzgE/FTk/HAnIObWJ6dBpKITI18Oof0Uv7zhu8UJUKdL5fsCrXBPX8kOg+C1Q
      pMAHKSAhl9ACAAA=
  # yamllint disable-line rule:line-length
  - path: /etc/mactab
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluACspKs3LNlAwMLAyMrYyMrFKMrNKNLEySuQqLskvSkxPBUulGliZJFuZ
      WVgZGViZGXABAEQ70k80AAAA
  # static DNS config
  - path: /etc/resolv.conf
    owner: root:root
    permissions: '0644'
    encoding: ""
    content: |-
      search home.chaosengine.net
      nameserver 192.168.40.254
run_cmd:
  - "/root/provision.sh >> /root/provision.log 2>> /root/provision.err"
boot_cmd:
  # enable NFS client
  - mkdir -p /var/lib/nfs/sm
  - rc-update add rpc.statd
  - rc-update add nfsclient
  # use static network config rather than connman
  - rc-update add networking boot
  - rc-update del connman boot
  # persistent network device naming
  - nameif -s
k3os:
  modules:
    - kvm
    - nvme
  sysctl:
    kernel.printk: "4 4 1 7"
    kernel.kptr_restrict: "1"
  dns_nameservers:
    - 192.168.40.254
  ntp_servers:
    - 0.us.pool.ntp.org
    - 1.us.pool.ntp.org
  token: SECRETSQUIRREL
  password: "$1$ZDYMI7GJ$0F0YZRwBXP4l3CQItcXMg/"
  k3s_args:
    - server
    - "--cluster-init"
    - "--tls-san"
    - "192.168.40.10"
    - "--tls-san"
    - "k8s.s.chaosengine.net"
    # replace with kube-vip LB
    - "--disable"
    - "servicelb"
    # replace with Cilium
    - "--flannel-backend=none"
    - "--disable-network-policy"
