---
hostname: m900-1
ssh_authorized_keys:
  - github:deekue
  - "ssh-ed25519
     AAAAC3NzaC1lZDI1NTE5AAAAIBIMWQez3DYo1jeHOOE3nG7RPllzzpKW2p2R7QwmOaoj
     apathy@chelone"
write_files:
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-ds.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICMRb0mICA2t1YmUtdmlwLWRzLnlhbWwArVZbb9owFH7nV1g8N6y0rOryxlo0VVpRBdX2ME2V
      cQ7g4diZL1w27b/v2IEQiKnotDygcHy+8527Qwv+BbThSqZk2W0tuMxSMga95Az6jCknbSsHSzNq
      adoiRNIcUrJwE0iWvNgKTEHZTmo2xkLeSpKkRWu29YSyDnV2rjT/RS3KOotb0+HqXcV6JxxC9UgJ
      OKCkUiobIMb/JVFbSK0lWAgm8Uy5AvHoVNtqB+3K89K9dBdAoj2bdgKC7YSgz580gk1KvrXb30s+
      MMppBkFmytyY9gWp3t8Z9M8FkVQZnpW4JehJwAhubPuiPQP/u6KWzb1q6WHQPeJlSumMy3qaYq4I
      oOYUGSnZSIMO35iGktgXqZH7jyjgcnZ+9ZrtcZzkydakT/YIpqGo23hfsY1azcZ4tY7GTX4As1jK
      hEQ7+d/7lxaF2bfqPYVcyTEczkbIK2o/czRpaY7BSScEngg6AbHtXrR01K6HPiWZOaG3rAb1stPr
      9BrRlMgTAZkCmHfAgMAUKV06k/vu+Fzz7lz/0GQh/ICVZmpZ8M/pTPhHHPCdn5Fzs4JBboMNiOmU
      S243ez4/o/2G1A/XT8c1ZPdOY7eO2RwyJ/DtYSZVJR6sgTkfWx1Z2hxvU/sMOjeHx0mZ6cG6wAk2
      +1VW11jAJg12QjMfRZlTPwJHGEJUAZr6apLBGufe/F9SpqRFcYKVlnAutwdRLrEqOzbcbnpW4/Z+
      STqrhQNyWT8uy4+Vf6G6qPEuqXD1lX6oXyhtI8o3vd51O2qcS0zpFCeliUIGucB+uowCGc90hOn6
      qsnDiheQdCLg7DAQUY1wE1Qf6ZhrWSZNhGpKhYlwmSV7q3ueBC+eDHToduyqt0INjpWmJ5Dv4zAN
      ElYZ0uI8xny9PgWzeoNtylUWAXWbIJplflaayt0PV53uzS12RKe7bwqeYxunZDZn2s/LbmFVL2lt
      J1X6T7gJn5TgDCevL1Z0s6dr3E67xVTd+r//VFKDi0jjCrvDgYO1rc82owWdcMEth6OZxwCPN9Nw
      8PzSv398GEbko/7XrXSujB2CXSm9COOxq4I5uGGHsQAsbhZd/4Dz1mE6xfZJyVBtF+2+rCcWSx1T
      buFXIeX3ztiiHGabkLnyMy1c1U5jS9mhy3Hf7RzAi92XFj/g/C0QPZNB+MiNiclH2KAbL2j9BS1I
      M1FXCwAA
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-cloud-controller.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICIbR0WICA2t1YmUtdmlwLWNsb3VkLWNvbnRyb2xsZXIueWFtbACtVD1v2zAQ3fUrBI1F6Tjt
      UgjokARoOqRpEANdigw0ebbZUCRxJJW6Rf97j9RHlMSxXaBaJB3v3ruPd+ROfQP0ypq6bE+Le2Vk
      XS4AWyXgTAgbTSgaCFzywOuiLA1voC7v4xJYqxwT2kbJhDUBrdaAvYd3XAxufusDNAVjrOATMlxy
      MeMxbCyqXzyQbXb/wc+UPRnTuNCRQvHWaniSAzfGhhzi02+5E4uo0UCADElnNjqKp6SqgBGqsZQu
      vfrVihgmeowaMhkrqYhLJDRfl98rYS1KZab5V3ddTuBtRAHZTQP34PuTFnCZrWsI1duyEgiUWPrq
      UkxfWvl85mLIUc9od3FQyiu1brjzKRCMdFaZQD8VtNB9+G6u/sRT+2L2253Zm2NJjZWQcQbo50hd
      IV2p1QMPYkPvvs67LIoXsz4ngzLr49XyUp8Hh7rsOdJwb2GVVdXXuoeMvF4q89+E5OPyB4hAWmLl
      zmX7jyvGnfOP27SgmcMq6gUcsdEObavkPjLvQKTwfvDXB1CclV+44WtoSIs3ViuxrcuvSIcgb4HL
      bZGU5cjOSTen+a9VqY7PpCCL2yvVqEAn88ypqYcWu+1vkqqu+BJ0fx2kWbrHZHqbsI2zhtj3pUmV
      OZ2uiQ550qb06Ccku2mOJKIi+gZ2ISZwZWhwg4UlmIbT4EZcVp7sw+tcGKONJhPLLWLDsrI0xY/7
      NNU9qqER1eV6IzAt1xDwGnHdzmfz2bsx/JCWJiQ3UetBB2f6gW/9eD65YX7/6a3S+MG7X75PCn0o
      xojAMezE82IDkq5v7CQqYcWjDmw0D24gIqqwvaCmwM8woSaupr/iL5H24AZQWbkAap+kFN/PR4Tp
      Il8f2OK/cfA8FXkHAAA=
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-cloud-controller-configmap.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICL9krWICA2NvbmZpZ21hcC55YW1sADXKPQ6DMAxA4d2n8AVISYRQ8Nq5K7shLrIgPyIpUm/f
      hY7v0+Ois5xVcyK8LOyaAuEzp7duLy4QpXHgxgSIiaMQ7p9FLi1318LrjV391iYR/vuq4ey2Iy98
      ENrJGTt6M/TGOv9wHn4QHWlKeQAAAA==
  # yamllint disable-line rule:line-length
  - path: /root/provision.sh
    owner: root:root
    permissions: '0744'
    encoding: gz+base64
    content: |
      H4sICIrZ0mICA3Byb3Zpc2lvbi5zaAC9Vltv2zYUfo5+xYlsN00X3ZymyNw4RXrdQ7sUaYdh6DqA
      liibsESqJOXUSPLfd0hJtmS7a7MBe7JFHp7L953zkb39YMJ4MCFq5vScHugZUyBLrkBwoAsqlzAR
      Qh+BEsApTRRoARMKLKF5ITTl2lFUg0dLAQUraEpY5jiZ4NOZkPw3RX+fiYy+ZGo+Tkmm6GrLLgUJ
      XQQqIa1VOQ4WRAYZmwTNohOTF1RqNXYDquNAqSyIzXcQE8/8YSmLiabKj6V2HUmnTGm5fC/F1+XY
      nWldqFEQRD8P/ejJqf849E+Go+NoeOo682N1VVkz2niXhMczKgPcC+Rq01+SPHMdJy15rBlCk4kp
      3DiAvzHJwJOQq+nY7T9CGwAazwS4/YcJZgU/Df4Y5IPEG/wyeDf4cAh9tHSdOwfBniJyekYhLqVE
      JMEUcwQYPp4DS4HpAwUkk5QkS2BcaZJlNDEF2toMJhjyIZ7GDFKFETu1IzwWkUPXQWefPoHHK5PV
      aRc+f4anJgWOWaPRPkwlLcD7cp3C2cMZBgZvCGdnZ1sHb0Ej0+BFh7hV8+OufYEFyL1IEsanUIO8
      BOsAXlzYSl1rV2PV9X5+3vKKZilzqGme2q1pMpqYTpTU0LOg3woB5w+GDp6uEdg3TLn9Du9dEHrQ
      NMyU6Vk58WORm17wmLAtwZQqqQqGYXTSs/+9Jycnp8fDk+MnTXYvBE/ZtJStpAqTlCkE+xThfHX5
      Gs638nByJqWQaoR2iYjnVPpMjCqQeFIIxnX1BeDBJtnG+XQW3/fIl5Is7xvl3kHmp8q//6n+TWep
      1zPEIC93P+4EcXYs+5YX1KmygIt3H0FRyXBqY8EVipPr1E0PWi8/PAYrA4wzrckEbm+rDj2we6OR
      pKog13wUKCObOMB6Cd5biKKTYRjWDhY6CsMD08RtV7uiKIrDa31046wPryw6RSQonpAKCW9riVyN
      +ARRuGlr7N3WkKNZy6Yt0Wg7HoOrZUm7p5pz+7sCRJu29RwAlMpM/7VxX6W8cbJTAqBaErd2UM2J
      ZwblFgoiNY77VmHOXiGxA5y9fJ6RCc1gWtgPY48jx3KCo0e/6scQDgApGTh7piOqCMYIx3JC7Tc2
      CbZUJTHV3gdNKnmto3v5DmRLpBbePAebB6SSUviz9n9bSenByKw+Pdhc9xZwEPph+OZ5ZdBvW8Ql
      3qjpELxktF5FxUVeDt0WHVbQb1bZ3n2DCC70FhVHWDK34myzxqaOqe/7bgudXZCv0gHYhbPbXyXj
      VojvArtOKxGc1gEt/GZQjQAnAq4pzAiqOsE3SF7geBgHzFy8z6zKVim9x8Vfy/xfk9RQ8QpZGn36
      a/T50WjNQ8NC1GKhzUGbgY2Etnho7483E9x1HFH4ePnyElRZFAJBFuhKWhDs44OTHJnzgU6BL3Ia
      8qiI1pcuDlVOtKG26/oOrvFKs0RVqNdBRKGRwqxi0HygLD5zKorpEN8V3uI1eLraR61rfHpmYBHy
      EH6gpPZ4bVFsHK8Ybl48W8j9F6q7ZJuAW4TvpvyfBu97tP+PxK+wrXvg1dXV5dWoBarRgFSUPAli
      RNcAiIvfl2P7fqr80q+IbdQZ19a1sKEVcscMYFo5mZu+TJiEDeu638yOV2z56obr3kHvdylf+y27
      w9herakyF/y2XJZFUo3P2qqRxUa6t2ptOVwr5Hlr2dd50QBZvXi7Oe11Pe6ZFt3jAvHAXHJ6JGlm
      /0AIYVuFz78RJF9srLc+1xw2tGBj7BSMjR5Z8WTswSOtj3q8tqCumDPS/jdiRPw4ag4AAA==
  # yamllint disable-line rule:line-length
  - path: /etc/network/interfaces
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluAJ1S227CMAx95yss7ZnSlnbaJLQv2E+YJJSobdzlAkLi4+e2BGiHNMRD
      1dg+Occ+DgZP0NBC71AoPoA2yvOfui2KeoF92dtg6vQCGYMR1qIJ2CwAQge6g0abGhznL5jQTUso
      5Xi41A22kS/JUgB/6hQcGjSgJfSJ87kvq+dZ1nOW9SssxZyleIUlS9P5ROljlptlgw1c+Q+2fg7W
      K97B7pbJM0722c88rNR59FowI49mlXOQfeZJ9v7BgCTjNGNadDXkZZnEL+V8hV4d8XQPz8tilHSe
      LFYqKsZw9obeoAse9uT8VZsMIAPE4OA4HA2IzfJLkPHIDBaOZGs3EFj1E7RVEnZk4ZtMtSdrVtoJ
      p1G2rOeVReE1mb+WXbt69GrdXrfLK2K8E6Nhx7HJlqSCrdWyum2ln2Zgid6UbOUqL0Cqw5T5QVcT
      YW7tFyJ/gZiwAwAA
  # yamllint disable-line rule:line-length
  - path: /etc/mactab
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICAAAAAACA3N0ZGluACspKs3LNlAwMLAyMrYyMrFKMrNKNLEySuQqLskvSkxPBUulGliZJFuZ
      WVgZGViZGXABAEQ70k80AAAA
  # static DNS config
  - path: /etc/resolv.conf
    owner: root:root
    permissions: '0644'
    encoding: ""
    content: |-
      search home.chaosengine.net
      nameserver 192.168.40.254
run_cmd:
  - "/root/provision.sh >> /root/provision.log 2>> /root/provision.err"
boot_cmd:
  # enable NFS client
  - mkdir -p /var/lib/nfs/sm
  - rc-update add rpc.statd
  - rc-update add nfsclient
  # use static network config rather than connman
  - rc-update add networking boot
  - rc-update del connman boot
  # persistent network device naming
  - nameif -s
k3os:
  modules:
    - kvm
    - nvme
  sysctl:
    kernel.printk: "4 4 1 7"
    kernel.kptr_restrict: "1"
  dns_nameservers:
    - 192.168.40.254
  ntp_servers:
    - 0.us.pool.ntp.org
    - 1.us.pool.ntp.org
  token: SECRETSQUIRREL
  password: "$1$ZDYMI7GJ$0F0YZRwBXP4l3CQItcXMg/"
  k3s_args:
    - server
    - "--cluster-init"
    - "--tls-san"
    - "192.168.40.10"
    - "--tls-san"
    - "k8s.s.chaosengine.net"
    # replace with kube-vip LB
    - "--disable"
    - "servicelb"
    # replace with Cilium
    - "--flannel-backend=none"
    - "--disable-network-policy"
