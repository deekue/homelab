---
hostname: m900-1
ssh_authorized_keys:
  - github:deekue
  - "ssh-ed25519
     AAAAC3NzaC1lZDI1NTE5AAAAIBIMWQez3DYo1jeHOOE3nG7RPllzzpKW2p2R7QwmOaoj
     apathy@chelone"
write_files:
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-ds.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICCXJrGICA2t1YmUtdmlwLWRzLnlhbWwArVZbb9owFH7nV1g8N6y0rOryxlo0VVpRBdX2ME2V
      cQ7g4diZL1w27b/vOIFgiKnotDygcHy+8527Qwv+BbThSqZk2W0tuMxSMga95Az6jCknbSsHSzNq
      adoiRNIcUrJwE0iWvNgKTEHZTmo2xkLeSpKkRQPbekJZhzo7V5r/ohZlncWt6XD1rma9Ew6heqQE
      HFBSKZUtIcb/JVFbSK0lWChN4plyBeLRqbbVDtq155V76S6ARHs27QSUthOCPn/SCDYp+dZuf6/4
      wCinGZQyU+XGtC9I/f7OoH+uFEmV4VmFW4KelBjBjW1ftGfgf1fUsrlXrTwsdY94mVI64zJMU8wV
      AdScIiMVG2nQ4RvTUBH7IjVy/xEFXM7Or16zPY6TPNma9MkewbQs6jbeV2yjVrMxXq2jcZMfwCyW
      MiHRTv73/qVFYfatek8hV3IMh7NR5hW1nzmatDTH4KQTAk8EnYDYdi9aOmrXQ5+SzJzQW9aDetnp
      dXqNaCrkiYBMAcw7YEBgipSunMl9d3wOvDvXPzRZCD9glZkgC/45nQn/iAO+8zNyblYwyG2wJWI6
      5ZLbzZ7Pz2i/IfXD9dNxDdm909itYzaHzAl8e5hJVYsHa2DOxxYiK5vjbWqfQefm8DipMj1YFzjB
      Zr/KQo0FbNLSTtnMR1Hm1I/AEYYQVYCmvppksMa5N/+XlClpUZxgpSWcy+1BlEusyo4Nt5ueBdze
      L0lnQTggl+FxVX6s/AvVRcC7pMKFK/1Qv1DaRpRver3rdtQ4l5jSKU5KEwV2fhnFMJ7pCMn1VZOC
      FS8g6UTA2REgop7eJiic5phrWSZNhGpKhYlwmSV7q3ueBO+cDHTZ6NhQb4UanChNTyDfx2EaJKwy
      pMVRjPl6fQpm9QY7lKssAuo2QTTL/Jg0lbsfrjrdm9tO77LT3TcFz7GDUzKbM+1HZber6pc0WEe1
      /hMuwSclOMOh64sV3ezpGhfTbifVF/7vP7XU4A7SuL3ucNZgbcOxZrSgEy645XA07hjg8VIaDp5f
      +vePD8OIfNT/upXOlbFDsCulFynx9W3tvAgv12EsAItLRYffbt46TKfYPikZqu2O3Zf1xE4JMdUC
      fhVSfeqMLcphtikzV32hlbe009hSduhyXHU7B/BO96XFbzd/AUTPZCl85MbE5CNs0I0XtP4CHGxy
      VFILAAA=
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-cloud-controller.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICKMDsmICA2t1YmUtdmlwLWNsb3VkLWNvbnRyb2xsZXIueWFtbACtVD1v2zAQ3fUrBI1F6Tjt
      UgjokARoOqRpEANdigw0ebbZUCRxJJW6Rf97j9RHlMSxXaBaJB3v3ruPd+ROfQP0ypq6bE+Le2Vk
      XS4AWyXgTAgbTSgaCFzywOuiLA1voC7v4xJYqxwT2kbJhDUBrdaAvYd3XAxufusDNAVjrOATMlxy
      MeMxbCyqXzyQbXb/wc+UPRnTuNCRQvHWaniSAzfGhhzi02+5E4uo0UCADElnNjqKp6SqgBGqsZQu
      vfrVihgmeowaMhkrqYhLJDRfl98rYS1KZab5V3ddTuBtRAHZTQP34PuTFnCZrWsI1duyEgiUWPrq
      UkxfWvl85mLIUc9od3FQyiu1brjzKRCMdFaZQD8VtNB9+G6u/sRT+2L2253Zm2NJjZWQcQbo50hd
      IV2p1QMPYkPvvs67LIoXsz4ngzLr49XyUp8Hh7rsOdJwb2GVVdXXuoeMvF4q89+E5OPyB4hAWmLl
      zmX7jyvGnfOP27SgmcMq6gUcsdEObavkPjLvQKTwfvDXB1CclV+44WtoSIs3ViuxrcuvSIcgb4HL
      bZGU5cjOSTen+a9VqY7PpCCL2yvVqEAn88ypqYcWu+1vkqqu+BJ0fx2kWbrHZHqbsI2zhtj3pUmV
      OZ2uiQ550qb06Ccku2mOJKIi+gZ2ISZwZWhwg4UlmIbT4EZcVp7sw+tcGKONJhPLLWLDsrI0xY/7
      NNU9qqER1eV6IzAt1xDwGnHdzmfz2bsx/JCWJiQ3UetBB2f6gW/9eD65YX7/6a3S+MG7X75PCn0o
      xojAMezE82IDkq5v7CQqYcWjDmw0D24gIqqwvaCmwM8woSaupr/iL5H24AZQWbkAap+kFN/PR4Tp
      Il8f2OK/cfA8FXkHAAA=
  # yamllint disable-line rule:line-length
  - path: /var/lib/rancher/k3s/server/manifests/kube-vip-cloud-controller-configmap.yaml
    owner: root:root
    permissions: '0644'
    encoding: gz+base64
    content: |
      H4sICL9krWICA2NvbmZpZ21hcC55YW1sADXKPQ6DMAxA4d2n8AVISYRQ8Nq5K7shLrIgPyIpUm/f
      hY7v0+Ois5xVcyK8LOyaAuEzp7duLy4QpXHgxgSIiaMQ7p9FLi1318LrjV391iYR/vuq4ey2Iy98
      ENrJGTt6M/TGOv9wHn4QHWlKeQAAAA==
  # yamllint disable-line rule:line-length
  - path: /root/provision.sh
    owner: root:root
    permissions: '0744'
    encoding: gz+base64
    content: |
      H4sICKA/smICA3Byb3Zpc2lvbi5zaAC9VV1v2zYUfbZ+xY2SLtsQfdjJhkytXbRr2pdsKZIOe8gy
      gJaubcISqZGUXWPJf9+lPmzJVpdhA5aHwCQP770859yr46NgykUwZXrhHDvHYBZcgyqEBikAV6g2
      MJXSnIGWIBATDUbCFIEnmOXSoDCORgMeFhJynuOM8dRxUinmC6nELxp/XcgU33G9HM9YqnF7VG4F
      Ca4CnbDWrhoHK6aClE+DZtNx+Azu7+EIPAUBmjhQTMQLVMHyXAcK51wbxVH7G5al8PAAL+kZKBwA
      jBcS3DkVeHd3DT++gRiVgZlUkCu+Ygahvr2BmFFEl+7EzMCrV97VzXuYPJvNGWRcKal05AwAEhkv
      Uflc0gpFkksuTHngAbgLY3IdBcHwh5E//P7Svwj90flldD4cXbrOgNJR7rUt1fujAvdjg5j5sTIu
      /EZ4inxT1ah1GtjHaTr37A8+4/QSKpPAzow7TsUFiVXk8OanT6BRcZZCLIUmhVxnrjC3uY3Z3F1U
      QbngxrApPD5WTJ6WZ1GkUOdsLaJAW+9QzWYD3jUMh9+NwrAOsDLDMDyFyaQTqi+LxrhQZYxunt3l
      LaL7ioQsVIp5XRvFrY3iTcE9+bPttCe344sK1sK0jUrY8Rhcowrs3mruHfUlGO5jG/cBFJqLOaxt
      /KrmvaudN0DCDHPrCC0vPkLOlMHk8GXOgMxMfTjIlimbYgrzvFxYvPV5xsje+NlcQPgCSJQXjdvs
      nwXlSk6xXJNPqGzbps3ZnaF/Y/fk6zq7l/VQW5C48OEtlHXATCHW7gQqu1T8NLK7L0/3970VnIZ+
      GH54WwFO2oi4oGaYjcBLot3uI1hhvnFbenjC1rSt9ukLSliYkOZAjjN6tkjsXlk5WTtG3/fdFkN9
      tFNJvSS7J9tK3IruPqYbdyRSYJ2qJN92KsAxjRJYIyzYCoHRIM5yag8bgRsuxWuCNMV8pM2fi+xf
      S9QIcUUaRfe/Rw/fRjsVGg2GLQ3aCrT53yvoQIX2+Xi/wL7rxMKnm3c3oIs8l8SypFCqJMFyAIJl
      pJkPOAexyjAUw3zo7IilnsqYsap2Yz/BmptFKVVFe51F5oZETCsN7YLm4usSkC1xNNNk1ffgmeqc
      hl0T07P9SpyH8A/e1O6uA41t4K3EwFKFLNkcUPdftO6qbRMeKN6v+d/13XO6/5/KN9w2Jri6vb25
      jVqs2v6fyUIkQUz0WgZp8/lxDJOvRk3gz0TusNOwre/C3pxQB2xUdWVsaZ2ZcAV78Npx9sTLD4J1
      83W/Qh/7Rh8Bj6D55h6Cy6/rTNtvfM+Xq8iTqoN2sGYoNsP74LWtiDQfJ621b7K8E36vmkE31MDa
      cyAkMUFFZHimMC1/QAhhOXwnX4ierfb2W8udblspyA29Y2LPGFttLB481lrUTXVAb6WWneh/AZ9S
      nA1mCwAA
run_cmd:
  - "/root/provision.sh >> /root/provision.log 2>> /root/provision.err"
boot_cmd:
  # enable NFS client
  - mkdir -p /var/lib/nfs/sm
  - rc-update add rpc.statd
  - rc-update add nfsclient
k3os:
  modules:
    - kvm
    - nvme
  sysctl:
    kernel.printk: "4 4 1 7"
    kernel.kptr_restrict: "1"
  dns_nameservers:
    - 192.168.40.254
  ntp_servers:
    - 0.us.pool.ntp.org
    - 1.us.pool.ntp.org
  token: SECRETSQUIRREL
  password: "$1$ZDYMI7GJ$0F0YZRwBXP4l3CQItcXMg/"
  k3s_args:
    - server
    - "--cluster-init"
    - "--tls-san"
    - "192.168.40.10"
    - "--tls-san"
    - "k8s.s.chaosengine.net"
    # replace with kube-vip LB
    - "--disable"
    - "servicelb"
    # replace with Cilium
    - "--flannel-backend=none"
    - "--disable-network-policy"
